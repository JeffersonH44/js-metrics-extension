{"version":3,"sources":["webpack:///mountainchart.js","webpack:///webpack/bootstrap 43bc40078ea947730f05","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/dialogs/axesmc/axesmc.js","webpack:///./src/mountainchart-math.js","webpack:///./src/mountainchart-probe.js","webpack:///./src/mountainchart-selectlist.js","webpack:///./src/dialogs/axesmc/axesmc.html","webpack:///./src/template.html"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","MountainChart","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","default_model","state","time","delay","delayThresholdX2","delayThresholdX4","entities","opacitySelectDim","opacityRegular","locale","ui","chart","manualSortingEnabled","yMaxMethod","showProbeX","probeX","xLogStops","xPoints","preload","preloadKey","buttons","dialogs","popup","sidebar","moreoptions","datawarning","doubtDomain","doubtRange","presentation","versionInfo","_interopRequireDefault","_defineProperty","key","writable","_mountainchartMath","_mountainchartMath2","_mountainchartSelectlist","_mountainchartSelectlist2","_mountainchartProbe","_mountainchartProbe2","_Vizabi","utils","_Vizabi$iconset","_globals","iconset","iconWarn","warn","iconQuestion","question","_Vizabi$helpers","helpers","Exporter","svgexport","axisSmart","DynamicBackground","MountainChartComponent","config","context","_this","template","model_expects","type","model_binds","change:time.value","evt","_readyOnce","marker","getFrame","frameChanged","bind","change:time.playing","playing","redrawDataPoints","change:marker.axis_x.xScaleFactor","ready","change:marker.axis_x.xScaleShift","change:marker.axis_x.tailFatX","change:marker.axis_x.tailCutX","change:marker.axis_x.tailFade","change:ui.chart.probeX","change:ui.chart.showProbeX","change:ui.chart.xPoints","change:ui.chart.xLogStops","updateSize","change:ui.chart.yMaxMethod","_adjustMaxY","force","change:time.record","record","_export","open","element","reset","change:marker.highlight","highlightMarkers","updateOpacity","change:marker.select","selectMarkers","_selectlist","redraw","updateDoubtOpacity","_probe","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker","path","indexOf","zoomToMaxMin","change:marker.group","change:marker.group.merge","updatePointers","change:marker.stack","change:marker.stack.which","pause","change:marker.stack.use","change:marker.color.palette","redrawDataPointsOnlyColors","_math","prefix","deleteClasses","area","d3","curve","curveBasis","x","xScale","rescale","y0","yScale","y1","y","stack","order","stackOrderReverse","cached","cScale","xAxis","rangeRatio","rangeShift","mesh","yMax","domReady","select","graph","xAxisEl","xTitleEl","yTitleEl","infoEl","dataWarningEl","yearEl","year","mountainMergeStackedContainer","mountainMergeGroupedContainer","mountainAtomicContainer","mountainLabelContainer","tooltip","eventAreaEl","probeEl","probeLineEl","probeTextEl","selectAll","onTap","_interact","_mouseout","afterPreload","xScaleFactor","axis_x","xScaleShift","precomputedShape","income_mountains","shape","length","scaleLog","domain","domainMin","domainMax","scaleLinear","Math","round","map","data","enter","append","attr","style","transition","duration","ease","easeLinear","readyOnce","on","dragging","level","invert","mouse","full","KEY","getDimension","TIMEDIM","remove","setText","formatDate","wScale","range","updateUIStrings","updateIndicators","values","valuesAggregated","color","axis_y","end","updateEntities","_spawnMasks","updateTime","frame","toString","meshLength","profiles","small","margin","top","right","left","bottom","infoElHeight","medium","large","presentationProfileChanges","activeProfile","getActiveProfile","height","parseInt","width","isRTL","yearLabelOptions","topOffset","getLayoutProfile","xAlign","yAlign","widthRatio","setConditions","resize","scaleType","scale","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","pivotingLimit","method","METHOD_REPEATING","stops","formatter","getTickFormatter","warnBB","node","getBBox","titleBBox","t","transform","hTranslate","translateX","translateY","generateMesh","mdl","zoomedMin","zoomedMax","x1","x2","isFinite","translator","getTFunction","getConceptprops","text","setIcon","parent","findChildByName","pin","rect","coord","makeAbsoluteContext","farthestViewportElement","toolRect","root","getBoundingClientRect","chartRect","setHook","show","setPos","hide","toggle","opacity","getUTCFullYear","someSelected","getScale","tickFormat","arguments","undefined","mountainPointers","getKeys","filter","axis_s","pointer","sortValue","aggrLevel","groupedPointers","nest","use","group","sortValues","a","b","entries","groupManualSort","manualSorting","isManualSortCorrect","isArray","forEach","groupSortValue","includes","sum","sortGroupKeys","which","stackedPointers","sort","sortKeys","mountainsMergeStacked","mountainsMergeGrouped","mountainsAtomic","exit","merge","mountains","isTouchDevice","_mousemove","_click","event","stopPropagation","onLongTap","highlightMarker","_setTooltip","getColorlegendMarker","label","getItems","showCloseCross","clearHighlighted","isSelected","selectMarker","someHighlighted","highlight","selectList","classed","isHighlighted","rebuild","nonSelectedOpacityZero","_sumLeafPointersByMarker","branch","OPACITY_REGULAR","OPACITY_SELECT_DIM","time_1","delayAnimations","vertices","_spawn","hidden","toStack","subgroup","concat","f","keys","keyIndex","verticesIndex","valuesPointer","max","mergeGrouped","mergeStacked","firstLast","_getFirstLastPointersInStack","_getVerticesOfaMergedShape","first","visible","e","yMaxGroup","visible2","last","arg","tailFatX","unscale","tailCutX","tailFade","k","PI","log","spawnMask","cosineShape","cosineArea","dX","exp","cos","norm","sigma","giniToSigma","mu","gdpToMu","distribution","acc","pdf","lognormal","options","prevValues","stackMode","dragOrPlay","each","view","_renderShape","isColorUseIndicator","palette","datum","random","easeCircle","write","id","fill","tooltipText","contentBBox","_join","_this2","getProp","Promise","resolve","dim","query","language","from","where","$and","join","$in","order_by","reject","load","JSON","parse","then","dataId","getData","err","stringify","Axes","updateView","markerID","selectDomainMinMax","selectZoomedMinMax","yMaxRadio","setModel","probeCheck","probeFieldEl","result","parseFloat","replace","what","push","MCMath","Class","rangeFrom","rangeTo","rangeStep","gdp","gini","normsinv","pow","normal","q","sqrt","r","MCProbe","highlightValue","sumValue","totalArea","leftArea","_computeAreas","formatter1","format","formatter2","heightOfLabels","string","iconClose","close","MCSelectList","_local","listData","descending","unique","geo","_id","labelCloseGroup","insert","sample","fontHeight","fontSizeToFontHeight","parentNode","titleHeight","maxFontHeight","currentAggrLevel","aggrLevelSpacing","groupLabels","spacing","number","closeGroup","closeTextBBox","setTimeout","unhighlightMarker"],"mappings":"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","file":"mountainchart.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 9);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(6);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\n__webpack_require__(2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"1.0.20\", build: 1509005981144 };\n\n// MOUNTAIN CHART TOOL\nvar MountainChart = Vizabi.Tool.extend(\"MountainChart\", {\n\n  /**\n   * Initializes the tool (MountainChart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"mountainchart\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"locale\", \"data\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n\n  default_model: {\n    state: {\n      time: {\n        \"delay\": 100,\n        \"delayThresholdX2\": 50,\n        \"delayThresholdX4\": 25\n      },\n      \"entities\": {\n        \"opacitySelectDim\": 0.3,\n        \"opacityRegular\": 0.7\n      }\n    },\n    locale: {},\n    ui: {\n      chart: {\n        manualSortingEnabled: true,\n        yMaxMethod: \"latest\",\n        showProbeX: true,\n        probeX: 1.85,\n        xLogStops: [1, 2, 5],\n        xPoints: 50,\n        preload: \"income_mountains\",\n        preloadKey: \"world\"\n      },\n      \"buttons\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"stack\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"stack\", \"axesmc\", \"colors\", \"presentation\", \"about\"]\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = MountainChart;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _mountainchartMath = __webpack_require__(3);\n\nvar _mountainchartMath2 = _interopRequireDefault(_mountainchartMath);\n\nvar _mountainchartSelectlist = __webpack_require__(5);\n\nvar _mountainchartSelectlist2 = _interopRequireDefault(_mountainchartSelectlist);\n\nvar _mountainchartProbe = __webpack_require__(4);\n\nvar _mountainchartProbe2 = _interopRequireDefault(_mountainchartProbe);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * VIZABI MOUNTAINCHART\n * This graph displays income distribution in the world\n *\n * Original code:\n * Angie https://github.com/angieskazka\n *\n * Contributions:\n * IncoCode https://github.com/IncoCode/\n * Arthur https://github.com/arthurcamara1\n *\n * Developed in Gapminder Foundation, 2015\n */\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    globals = _Vizabi._globals,\n    _Vizabi$iconset = _Vizabi.iconset,\n    iconWarn = _Vizabi$iconset.warn,\n    iconQuestion = _Vizabi$iconset.question,\n    _Vizabi$helpers = _Vizabi.helpers,\n    Exporter = _Vizabi$helpers.svgexport,\n    axisSmart = _Vizabi$helpers[\"d3.axisWithLabelPicker\"],\n    DynamicBackground = _Vizabi$helpers[\"d3.dynamicBackground\"];\n\n\nvar THICKNESS_THRESHOLD = 0.001;\nvar COLOR_WHITEISH = \"#d3d3d3\";\n\n// MOUNTAIN CHART COMPONENT\nvar MountainChartComponent = Vizabi.Component.extend(\"mountainchart\", {\n\n  /**\n   * Initialize the component\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n\n    var _this = this;\n    this.name = \"mountainchart\";\n    this.template = __webpack_require__(8);\n\n    //define expected models for this component\n    this.model_expects = [{ name: \"time\", type: \"time\" }, { name: \"entities\", type: \"entities\" }, { name: \"marker\", type: \"marker\" }, { name: \"locale\", type: \"locale\" }, { name: \"data\", type: \"data\" }, { name: \"ui\", type: \"ui\" }];\n\n    //attach event listeners to the model items\n    this.model_binds = {\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:time.playing\": function changeTimePlaying(evt) {\n        // this listener is a patch for fixing #1228. time.js doesn't produce the last event\n        // with playing == false when paused softly\n        if (!_this.model.time.playing) {\n          _this.redrawDataPoints();\n        }\n      },\n      \"change:marker.axis_x.xScaleFactor\": function changeMarkerAxis_xXScaleFactor() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.xScaleShift\": function changeMarkerAxis_xXScaleShift() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFatX\": function changeMarkerAxis_xTailFatX() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailCutX\": function changeMarkerAxis_xTailCutX() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFade\": function changeMarkerAxis_xTailFade() {\n        _this.ready();\n      },\n      \"change:ui.chart.probeX\": function changeUiChartProbeX() {\n        _this.ready();\n      },\n      \"change:ui.chart.showProbeX\": function changeUiChartShowProbeX() {\n        _this.ready();\n      },\n      \"change:ui.chart.xPoints\": function changeUiChartXPoints() {\n        _this.ready();\n      },\n      \"change:ui.chart.xLogStops\": function changeUiChartXLogStops() {\n        _this.updateSize();\n      },\n      \"change:ui.chart.yMaxMethod\": function changeUiChartYMaxMethod() {\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n      },\n      \"change:time.record\": function changeTimeRecord(evt) {\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this.redrawDataPoints();\n        _this._probe.redraw();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker\": function changeMarker(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          _this.zoomToMaxMin();\n          _this.redrawDataPoints();\n          _this._probe.redraw();\n        }\n      },\n      \"change:marker.group\": function changeMarkerGroup(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"group.merge\") > -1) return;\n        _this.ready();\n      },\n      \"change:marker.group.merge\": function changeMarkerGroupMerge(evt) {\n        if (!_this._readyOnce) return;\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      },\n      \"change:marker.stack\": function changeMarkerStack(evt) {\n        if (!_this._readyOnce) return;\n        _this.ready();\n      },\n      \"change:marker.stack.which\": function changeMarkerStackWhich(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.stack.use\": function changeMarkerStackUse(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPointsOnlyColors();\n        _this._selectlist.redraw();\n      }\n    };\n\n    this._super(config, context);\n\n    this._math = new _mountainchartMath2.default(this);\n    this._export = new Exporter(this);\n    this._export.prefix(\"vzb-mc-\").deleteClasses([\"vzb-mc-mountains-mergestacked\", \"vzb-mc-mountains-mergegrouped\", \"vzb-mc-mountains\", \"vzb-mc-year\", \"vzb-mc-mountains-labels\", \"vzb-mc-axis-labels\"]);\n    this._probe = new _mountainchartProbe2.default(this);\n    this._selectlist = new _mountainchartSelectlist2.default(this);\n\n    // define path generator\n    this.area = d3.area().curve(d3.curveBasis).x(function (d) {\n      return _this.xScale(_this._math.rescale(d.x));\n    }).y0(function (d) {\n      return _this.yScale(d.y0);\n    }).y1(function (d) {\n      return _this.yScale(d.y0 + d.y);\n    });\n\n    //define d3 stack layout\n    this.stack = d3.stack().order(d3.stackOrderReverse).value(function (d, key) {\n      return _this.cached[key][d].y;\n    });\n\n    // init internal variables\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n\n    this.rangeRatio = 1;\n    this.rangeShift = 0;\n    this.cached = {};\n    this.mesh = [];\n    this.yMax = 0;\n  },\n  domReady: function domReady() {\n    var _this = this;\n\n    // reference elements\n    this.element = d3.select(this.element);\n    this.graph = this.element.select(\".vzb-mc-graph\");\n    this.xAxisEl = this.graph.select(\".vzb-mc-axis-x\");\n    this.xTitleEl = this.graph.select(\".vzb-mc-axis-x-title\");\n    this.yTitleEl = this.graph.select(\".vzb-mc-axis-y-title\");\n    this.infoEl = this.graph.select(\".vzb-mc-axis-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yearEl = this.graph.select(\".vzb-mc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.mountainMergeStackedContainer = this.graph.select(\".vzb-mc-mountains-mergestacked\");\n    this.mountainMergeGroupedContainer = this.graph.select(\".vzb-mc-mountains-mergegrouped\");\n    this.mountainAtomicContainer = this.graph.select(\".vzb-mc-mountains\");\n    this.mountainLabelContainer = this.graph.select(\".vzb-mc-mountains-labels\");\n    this.tooltip = this.element.select(\".vzb-mc-tooltip\");\n    this.eventAreaEl = this.element.select(\".vzb-mc-eventarea\");\n    this.probeEl = this.element.select(\".vzb-mc-probe\");\n    this.probeLineEl = this.probeEl.select(\"line\");\n    this.probeTextEl = this.probeEl.selectAll(\"text\");\n\n    this.element.onTap(function (d, i) {\n      _this._interact()._mouseout(d, i);\n    });\n  },\n  afterPreload: function afterPreload() {\n    var _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    if (!this.precomputedShape || !this.precomputedShape[0] || !this.precomputedShape[0].income_mountains) return;\n\n    var yMax = this.precomputedShape[0].income_mountains[\"yMax_\" + this.model.ui.chart.yMaxMethod];\n    var shape = this.precomputedShape[0].income_mountains.shape;\n\n    if (!yMax || !shape || shape.length === 0) return;\n\n    this.xScale = d3.scaleLog().domain([this.model.marker.axis_x.domainMin, this.model.marker.axis_x.domainMax]);\n    this.yScale = d3.scaleLinear().domain([0, Math.round(yMax)]);\n\n    _this.updateSize(shape.length);\n    _this.zoomToMaxMin();\n\n    shape = shape.map(function (m, i) {\n      return { x: _this.mesh[i], y0: 0, y: +m };\n    });\n\n    this.mountainAtomicContainer.selectAll(\".vzb-mc-prerender\").data([0]).enter().append(\"path\").attr(\"class\", \"vzb-mc-prerender\").style(\"fill\", \"pink\").style(\"opacity\", 0).attr(\"d\", _this.area(shape)).transition().duration(1000).ease(d3.easeLinear).style(\"opacity\", 1);\n  },\n  readyOnce: function readyOnce() {\n\n    this.eventAreaEl.on(\"mousemove\", function () {\n      if (_this.model.time.dragging) return;\n      if (!_this.model.ui.chart.showProbeX) return;\n      _this._probe.redraw({\n        level: _this.xScale.invert(d3.mouse(this)[0]),\n        full: true\n      });\n    }).on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      if (!_this.model.ui.chart.showProbeX) return;\n      _this._probe.redraw();\n    });\n\n    var _this = this;\n    this.on(\"resize\", function () {\n      //console.log(\"acting on resize\");\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updatePointers(); // respawn is needed\n      _this.redrawDataPoints();\n      _this._selectlist.redraw();\n      _this._probe.redraw();\n    });\n\n    this.KEY = this.model.entities.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n\n    this.mountainAtomicContainer.select(\".vzb-mc-prerender\").remove();\n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.wScale = d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange);\n  },\n  ready: function ready() {\n    //console.log(\"ready\")\n    var _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.model.marker.getFrame(this.model.time.value, function (values) {\n      if (!values) return;\n      _this.values = values;\n      _this.valuesAggregated = { color: {}, axis_y: {} };\n\n      _this.model.marker.getFrame(_this.model.time.end, _this.updateEntities.bind(_this));\n      _this.updateSize();\n      _this.zoomToMaxMin();\n      _this._spawnMasks();\n      _this.updateTime();\n      _this.updatePointers();\n      _this._adjustMaxY({ force: true });\n      _this.redrawDataPoints();\n      _this.redrawDataPointsOnlyColors();\n      _this.highlightMarkers();\n      _this.selectMarkers();\n      _this._selectlist.redraw();\n      _this.updateOpacity();\n      _this.updateDoubtOpacity();\n      _this._probe.redraw();\n    });\n  },\n  frameChanged: function frameChanged(frame, time) {\n    if (!frame) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.values = frame;\n    this.updateTime();\n    this.updatePointers();\n    this.redrawDataPoints();\n    this._selectlist.redraw();\n    this._probe.redraw();\n    this.updateDoubtOpacity();\n  },\n  updateSize: function updateSize(meshLength) {\n    var profiles = {\n      small: {\n        margin: { top: 10, right: 10, left: 10, bottom: 18 },\n        infoElHeight: 16\n      },\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 30 },\n        infoElHeight: 20\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 35 },\n        infoElHeight: 22\n      }\n    };\n\n    var presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 50 },\n        infoElHeight: 26\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 50 },\n        infoElHeight: 32\n      }\n    };\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    //mesure width and height\n\n    this.height = parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Mountain chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    var isRTL = this.model.locale.isRTL();\n\n    var yearLabelOptions = {\n      topOffset: this.getLayoutProfile() === \"large\" ? margin.top * 2 : 0,\n      xAlign: this.getLayoutProfile() === \"large\" ? isRTL ? \"left\" : \"right\" : \"center\",\n      yAlign: this.getLayoutProfile() === \"large\" ? \"top\" : \"center\",\n      widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 8 / 10\n    };\n\n    //year is centered and resized\n    this.year.setConditions(yearLabelOptions).resize(this.width, this.height);\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n    //need to know scale type of X to move on\n    var scaleType = this._readyOnce ? this.model.marker.axis_x.scaleType : \"log\";\n\n    //axis is updated\n    this.xAxis.scale(this.xScale).tickSizeOuter(0).tickPadding(9).tickSizeMinor(3, 0).labelerOptions({\n      scaleType: scaleType,\n      toolMargin: margin,\n      pivotingLimit: margin.bottom * 1.5,\n      method: this.xAxis.METHOD_REPEATING,\n      stops: this._readyOnce ? this.model.ui.chart.xLogStops : [1],\n      formatter: this.model.marker.axis_x.getTickFormatter()\n    });\n\n    this.xAxisEl.attr(\"transform\", \"translate(0,\" + this.height + \")\").call(this.xAxis);\n\n    this.xTitleEl.select(\"text\").attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\").attr(\"dy\", \"-0.36em\");\n\n    this.yTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n    var warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\").attr(\"width\", warnBB.height).attr(\"height\", warnBB.height).attr(\"x\", warnBB.height * 0.1).attr(\"y\", -warnBB.height * 1.0 + 1);\n\n    this.dataWarningEl.attr(\"transform\", \"translate(\" + (isRTL ? this.width - warnBB.width - warnBB.height * 2 : 0) + \",\" + (margin.top + warnBB.height * 1.5) + \")\").select(\"text\").attr(\"dx\", warnBB.height * 1.5);\n\n    if (this.infoEl.select(\"svg\").node()) {\n      var titleBBox = this.yTitleEl.node().getBBox();\n      var t = utils.transform(this.yTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.infoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.infoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.eventAreaEl.attr(\"y\", this.height).attr(\"width\", this.width).attr(\"height\", margin.bottom);\n\n    if (!meshLength) meshLength = this.model.ui.chart.xPoints;\n    this.mesh = this._math.generateMesh(meshLength, scaleType, this.xScale.domain());\n  },\n  zoomToMaxMin: function zoomToMaxMin() {\n    var _this = this;\n    var mdl = this.model.marker.axis_x;\n\n    if (mdl.zoomedMin == null && mdl.domainMin == null || mdl.zoomedMax == null && mdl.domainMin == null) return;\n\n    var x1 = this.xScale(mdl.zoomedMin || mdl.domainMin);\n    var x2 = this.xScale(mdl.zoomedMax || mdl.domainMax);\n    // if we have same x1 and x2 then divider will be 0 and rangeRation will become -Infinity\n    if (!isFinite(x1) || !isFinite(x2) || x1 === x2) return;\n\n    this.rangeRatio = this.width / (x2 - x1) * this.rangeRatio;\n    this.rangeShift = (this.rangeShift - x1) / (x2 - x1) * this.width;\n\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n    this.xAxisEl.call(this.xAxis);\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    var xConceptprops = this.model.marker.axis_x.getConceptprops();\n\n    this.xTitleEl.select(\"text\").text(this.translator(\"unit/mountainchart_hardcoded_income_per_day\"));\n\n    this.yTitleEl.select(\"text\").text(this.translator(\"mount/title\"));\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\").text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.infoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.infoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.infoEl.on(\"mouseover\", function () {\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.infoEl.on(\"mouseout\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    this.dataWarningEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n    }).on(\"mouseover\", function () {\n      _this.updateDoubtOpacity(1);\n    }).on(\"mouseout\", function () {\n      _this.updateDoubtOpacity();\n    });\n  },\n  updateDoubtOpacity: function updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n  updateIndicators: function updateIndicators() {\n    var _this = this;\n\n    //fetch scales, or rebuild scales if there are none, then fetch\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.cScale = this.model.marker.color.getScale();\n\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n  updateEntities: function updateEntities() {\n    var values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.values;\n\n    var _this = this;\n\n    // construct pointers\n    this.mountainPointers = this.model.marker.getKeys().filter(function (d) {\n      return 1 && values.axis_x[d[_this.KEY]] && values.axis_y[d[_this.KEY]] && values.axis_s[d[_this.KEY]];\n    }).map(function (d) {\n      var pointer = {};\n      pointer[_this.KEY] = d[_this.KEY];\n      pointer.KEY = function () {\n        return this[_this.KEY];\n      };\n      pointer.sortValue = [values.axis_y[pointer.KEY()] || 0, 0];\n      pointer.aggrLevel = 0;\n      return pointer;\n    });\n\n    //TODO: optimise this!\n    this.groupedPointers = d3.nest().key(function (d) {\n      return _this.model.marker.stack.use === \"property\" ? values.stack[d.KEY()] : values.group[d.KEY()];\n    }).sortValues(function (a, b) {\n      return b.sortValue[0] - a.sortValue[0];\n    }).entries(this.mountainPointers);\n\n    var groupManualSort = this.model.marker.group.manualSorting;\n    var isManualSortCorrect = utils.isArray(groupManualSort) && groupManualSort.length > 1;\n    this.groupedPointers.forEach(function (group) {\n      var groupSortValue = isManualSortCorrect ? groupManualSort.includes(group.key) ? groupManualSort.length - 1 - groupManualSort.indexOf(group.key) : -1 : d3.sum(group.values.map(function (m) {\n        return m.sortValue[0];\n      }));\n\n      group.values.forEach(function (d) {\n        d.sortValue[1] = groupSortValue;\n      });\n\n      group[_this.model.entities.getDimension()] = group.key; // hack to get highlihgt and selection work\n      group.KEY = function () {\n        return this.key;\n      };\n      group.aggrLevel = 1;\n    });\n\n    var sortGroupKeys = {};\n    _this.groupedPointers.forEach(function (m) {\n      sortGroupKeys[m.key] = m.values[0].sortValue[1];\n    });\n\n    // update the stacked pointers\n    if (_this.model.marker.stack.which === \"none\") {\n      this.stackedPointers = [];\n      this.mountainPointers.sort(function (a, b) {\n        return b.sortValue[0] - a.sortValue[0];\n      });\n    } else {\n      this.stackedPointers = d3.nest().key(function (d) {\n        return values.stack[d.KEY()];\n      }).key(function (d) {\n        return values.group[d.KEY()];\n      }).sortKeys(function (a, b) {\n        return sortGroupKeys[b] - sortGroupKeys[a];\n      }).sortValues(function (a, b) {\n        return b.sortValue[0] - a.sortValue[0];\n      }).entries(this.mountainPointers);\n\n      this.mountainPointers.sort(function (a, b) {\n        return b.sortValue[1] - a.sortValue[1];\n      });\n\n      this.stackedPointers.forEach(function (stack) {\n        stack.KEY = function () {\n          return this.key;\n        };\n        stack[_this.model.entities.getDimension()] = stack.key; // hack to get highlihgt and selection work\n        stack.aggrLevel = 2;\n      });\n    }\n\n    //bind the data to DOM elements\n    this.mountainsMergeStacked = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel2\").data(this.stackedPointers);\n    this.mountainsMergeGrouped = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel1\").data(this.groupedPointers);\n    this.mountainsAtomic = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel0\").data(this.mountainPointers);\n\n    //exit selection -- remove shapes\n    this.mountainsMergeStacked.exit().remove();\n    this.mountainsMergeGrouped.exit().remove();\n    this.mountainsAtomic.exit().remove();\n\n    //enter selection -- add shapes\n    this.mountainsMergeStacked = this.mountainsMergeStacked.enter().append(\"path\").attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel2\").merge(this.mountainsMergeStacked);\n    this.mountainsMergeGrouped = this.mountainsMergeGrouped.enter().append(\"path\").attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel1\").merge(this.mountainsMergeGrouped);\n    this.mountainsAtomic = this.mountainsAtomic.enter().append(\"path\").attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel0\").merge(this.mountainsAtomic);\n\n    //add interaction\n    this.mountains = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain\");\n\n    this.mountains.on(\"mousemove\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _this._interact()._mousemove(d, i);\n    }).on(\"mouseout\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _this._interact()._mouseout(d, i);\n    }).on(\"click\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _this._interact()._click(d, i);\n      _this.highlightMarkers();\n    }).onTap(function (d, i) {\n      _this._interact()._click(d, i);\n      d3.event.stopPropagation();\n    }).onLongTap(function (d, i) {});\n  },\n  _interact: function _interact() {\n    var _this = this;\n\n    return {\n      _mousemove: function _mousemove(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this.model.marker.highlightMarker(d);\n\n        var mouse = d3.mouse(_this.graph.node()).map(function (d) {\n          return parseInt(d);\n        });\n\n        //position tooltip\n        _this._setTooltip(d.key ? _this.model.marker.color.getColorlegendMarker().label.getItems()[d.key] : _this.values.label[d.KEY()]);\n        _this._selectlist.showCloseCross(d, true);\n      },\n      _mouseout: function _mouseout(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this._setTooltip(\"\");\n        _this.model.marker.clearHighlighted();\n        _this._selectlist.showCloseCross(d, false);\n      },\n      _click: function _click(d) {\n        var isPlayingOrDragging = _this.model.time.dragging || _this.model.time.playing;\n        if (!isPlayingOrDragging || _this.model.marker.isSelected(d)) {\n          _this.model.marker.selectMarker(d);\n        }\n      }\n    };\n  },\n  highlightMarkers: function highlightMarkers() {\n    var _this = this;\n    this.someHighlighted = this.model.marker.highlight.length > 0;\n\n    if (!this.selectList || !this.someSelected) return;\n    this.selectList.classed(\"vzb-highlight\", function (d) {\n      return _this.model.marker.isHighlighted(d);\n    });\n  },\n  selectMarkers: function selectMarkers() {\n    var _this = this;\n    this.someSelected = this.model.marker.select.length > 0;\n\n    this._selectlist.rebuild();\n    this.nonSelectedOpacityZero = false;\n  },\n  _sumLeafPointersByMarker: function _sumLeafPointersByMarker(branch, marker) {\n    var _this = this;\n    if (!branch.key) return _this.values[marker][branch.KEY()];\n    return d3.sum(branch.values.map(function (m) {\n      return _this._sumLeafPointersByMarker(m, marker);\n    }));\n  },\n  updateOpacity: function updateOpacity() {\n    var _this = this;\n    //if(!duration)duration = 0;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = 0.3;\n    var OPACITY_SELECT = 1.0;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.mountains.style(\"opacity\", function (d) {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n    });\n\n    this.mountains.classed(\"vzb-selected\", function (d) {\n      return _this.model.marker.isSelected(d);\n    });\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.mountainsAtomic.style(\"pointer-events\", function (d) {\n        return !_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d) ? \"visible\" : \"none\";\n      });\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n  updateTime: function updateTime() {\n    var _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && this.time - this.time_1 > 0 ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n  },\n  updatePointers: function updatePointers() {\n    var _this = this;\n    this.yMax = 0;\n\n    //spawn the original mountains\n    this.mountainPointers.forEach(function (d, i) {\n      var vertices = _this._spawn(_this.values, d);\n      _this.cached[d.KEY()] = vertices;\n      d.hidden = vertices.length === 0;\n    });\n\n    //recalculate stacking\n    if (_this.model.marker.stack.which !== \"none\") {\n      this.stackedPointers.forEach(function (group) {\n        var toStack = [];\n        group.values.forEach(function (subgroup) {\n          toStack = toStack.concat(subgroup.values.filter(function (f) {\n            return !f.hidden;\n          }));\n        });\n        _this.stack.keys(toStack.map(function (d) {\n          return d.KEY();\n        }))(d3.range(_this.mesh.length)).forEach(function (vertices, keyIndex) {\n          var key = toStack[keyIndex].KEY();\n          vertices.forEach(function (d, verticesIndex) {\n            _this.cached[key][verticesIndex].y0 = d[0];\n          });\n        });\n      });\n    }\n\n    this.mountainPointers.forEach(function (d) {\n      d.valuesPointer = _this.values;\n      d.yMax = d3.max(_this.cached[d.KEY()].map(function (m) {\n        return m.y0 + m.y;\n      }));\n      if (_this.yMax < d.yMax) _this.yMax = d.yMax;\n    });\n\n    var mergeGrouped = _this.model.marker.group.merge;\n    var mergeStacked = _this.model.marker.stack.merge;\n    //var dragOrPlay = (_this.model.time.dragging || _this.model.time.playing) && this.model.marker.stack.which !== \"none\";\n\n    //if(mergeStacked){\n    this.stackedPointers.forEach(function (d) {\n      d.valuesPointer = _this.valuesAggregated;\n      var firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = \"_default\";\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //} else if (mergeGrouped || dragOrPlay){\n    this.groupedPointers.forEach(function (d) {\n      d.valuesPointer = _this.valuesAggregated;\n      var firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = _this.values.color[firstLast.first.KEY()];\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //}\n\n    if (!mergeStacked && !mergeGrouped && this.model.marker.stack.use === \"property\") {\n      this.groupedPointers.forEach(function (d) {\n        var visible = d.values.filter(function (f) {\n          return !f.hidden;\n        });\n        d.yMax = visible[0].yMax;\n        d.values.forEach(function (e) {\n          e.yMaxGroup = d.yMax;\n        });\n      });\n    }\n  },\n  _getFirstLastPointersInStack: function _getFirstLastPointersInStack(group) {\n    var visible = void 0,\n        visible2 = void 0;\n    var first = void 0,\n        last = void 0;\n\n    if (group.values[0].values) {\n      visible = group.values[0].values.filter(function (f) {\n        return !f.hidden;\n      });\n      visible2 = group.values[group.values.length - 1].values.filter(function (f) {\n        return !f.hidden;\n      });\n      first = visible[0];\n      last = visible2[visible2.length - 1];\n    } else {\n      visible = group.values.filter(function (f) {\n        return !f.hidden;\n      });\n      first = visible[0];\n      last = visible[visible.length - 1];\n    }\n\n    if (!visible.length || visible2 && !visible2.length) utils.warn(\"mountain chart failed to generate shapes. check the incoming data\");\n\n    return {\n      first: first,\n      last: last\n    };\n  },\n  _getVerticesOfaMergedShape: function _getVerticesOfaMergedShape(arg) {\n    var _this = this;\n\n    var first = arg.first.KEY();\n    var last = arg.last.KEY();\n\n    return _this.mesh.map(function (m, i) {\n      var y = _this.cached[first][i].y0 + _this.cached[first][i].y - _this.cached[last][i].y0;\n      var y0 = _this.cached[last][i].y0;\n      return {\n        x: m,\n        y0: y0,\n        y: y\n      };\n    });\n  },\n  _spawnMasks: function _spawnMasks() {\n    var _this = this;\n\n    var tailFatX = this._math.unscale(this.model.marker.axis_x.tailFatX);\n    var tailCutX = this._math.unscale(this.model.marker.axis_x.tailCutX);\n    var tailFade = this.model.marker.axis_x.tailFade;\n    var k = 2 * Math.PI / (Math.log(tailFatX) - Math.log(tailCutX));\n    var m = Math.PI - Math.log(tailFatX) * k;\n\n    this.spawnMask = [];\n    this.cosineShape = [];\n    this.cosineArea = 0;\n\n    this.mesh.forEach(function (dX, i) {\n      _this.spawnMask[i] = dX < tailCutX ? 1 : dX > tailFade * 7 ? 0 : Math.exp((tailCutX - dX) / tailFade);\n      _this.cosineShape[i] = dX > tailCutX && dX < tailFatX ? 1 + Math.cos(Math.log(dX) * k + m) : 0;\n      _this.cosineArea += _this.cosineShape[i];\n    });\n  },\n  _spawn: function _spawn(values, d) {\n    var _this = this;\n\n    var norm = values.axis_y[d.KEY()];\n    var sigma = _this._math.giniToSigma(values.axis_s[d.KEY()]);\n    var mu = _this._math.gdpToMu(values.axis_x[d.KEY()], sigma);\n\n    if (!norm || !mu || !sigma) return [];\n\n    var distribution = [];\n    var acc = 0;\n\n    this.mesh.forEach(function (dX, i) {\n      distribution[i] = _this._math.pdf.lognormal(dX, mu, sigma);\n      acc += _this.spawnMask[i] * distribution[i];\n    });\n\n    var result = this.mesh.map(function (dX, i) {\n      return {\n        x: dX,\n        y0: 0,\n        y: norm * (distribution[i] * (1 - _this.spawnMask[i]) + _this.cosineShape[i] / _this.cosineArea * acc)\n      };\n    });\n\n    return result;\n  },\n  _adjustMaxY: function _adjustMaxY(options) {\n    if (!options) options = {};\n    var _this = this;\n    var method = this.model.ui.chart.yMaxMethod;\n\n    if (method !== \"immediate\" && !options.force) return;\n    if (method === \"latest\") {\n      var prevValues = _this.values;\n      _this.model.marker.getFrame(_this.model.time.end, function (values) {\n        if (!values) return;\n\n        //below is a complicated issue when updatePointers() is first calculated for one set of values (at the end of time series), then yMax is taken from that data (assuming that population always grows, so the last year has the highest mountain)\n        _this.values = values;\n        _this.updatePointers();\n\n        //after that updatePointers() is called with the actual data of the current time point\n        _this.values = prevValues;\n        _this.yScale.domain([0, Math.round(_this.yMax)]);\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      });\n    } else {\n      if (!_this.yMax) utils.warn(\"Setting yMax to \" + _this.yMax + \". You failed again :-/\");\n      _this.yScale.domain([0, Math.round(_this.yMax)]);\n    }\n  },\n  redrawDataPoints: function redrawDataPoints() {\n    var _this = this;\n    var mergeGrouped = this.model.marker.group.merge;\n    var mergeStacked = this.model.marker.stack.merge;\n    var stackMode = this.model.marker.stack.which;\n    //it's important to know if the chart is dragging or playing at the moment.\n    //because if that is the case, the mountain chart will merge the stacked entities to save performance\n    var dragOrPlay = (this.model.time.dragging || this.model.time.playing) &&\n    //never merge when no entities are stacked\n    stackMode !== \"none\";\n\n    this._adjustMaxY();\n\n    this.mountainsMergeStacked.each(function (d) {\n      var view = d3.select(this);\n      var hidden = !mergeStacked;\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsMergeGrouped.each(function (d) {\n      var view = d3.select(this);\n      var hidden = !mergeGrouped && !dragOrPlay || mergeStacked && !_this.model.marker.isSelected(d);\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsAtomic.each(function (d, i) {\n      var view = d3.select(this);\n      var hidden = d.hidden || (mergeGrouped || mergeStacked || dragOrPlay) && !_this.model.marker.isSelected(d);\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    if (stackMode === \"none\") {\n      this.mountainsAtomic.sort(function (a, b) {\n        return b.yMax - a.yMax;\n      });\n    } else if (stackMode === \"all\") {\n      // do nothing if everything is stacked\n\n    } else {\n      if (mergeGrouped || dragOrPlay) {\n        // this.mountainsMergeGrouped.sort(function (a, b) {\n        //     return b.yMax - a.yMax;\n        // });\n      } else {\n        this.mountainsAtomic.sort(function (a, b) {\n          return b.yMaxGroup - a.yMaxGroup;\n        });\n      }\n    }\n\n    // exporting shapes for shape preloader. is needed once in a while\n    // if (!this.shapes) this.shapes = {}\n    // this.shapes[this.model.time.value.getUTCFullYear()] = {\n    //     yMax: d3.format(\".2e\")(_this.yMax),\n    //     shape: _this.cached[\"all\"].map(function (d) {return d3.format(\".2e\")(d.y);})\n    // }\n  },\n  redrawDataPointsOnlyColors: function redrawDataPointsOnlyColors() {\n    var _this = this;\n    if (!this.mountains) return utils.warn(\"redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!\");\n    var isColorUseIndicator = this.model.marker.color.use === \"indicator\";\n    this.mountains.style(\"fill\", function (d) {\n      return d.valuesPointer.color[d.KEY()] ? isColorUseIndicator && d.valuesPointer.color[d.KEY()] == \"_default\" ? _this.model.marker.color.palette[\"_default\"] : _this.cScale(d.valuesPointer.color[d.KEY()]) : COLOR_WHITEISH;\n    });\n  },\n  _renderShape: function _renderShape(view, key, hidden) {\n    var stack = this.model.marker.stack.which;\n    var _this = this;\n    var valuesPointer = view.datum().valuesPointer;\n\n    view.classed(\"vzb-hidden\", hidden);\n\n    if (hidden) {\n      if (stack !== \"none\") view.style(\"stroke-opacity\", 0);\n      return;\n    }\n\n    var filter = {};\n    filter[this.KEY] = key;\n    if (this.model.marker.isSelected(filter)) {\n      view.attr(\"d\", this.area(this.cached[key].filter(function (f) {\n        return f.y > valuesPointer.axis_y[key] * THICKNESS_THRESHOLD;\n      })));\n    } else {\n      view.attr(\"d\", this.area(this.cached[key]));\n    }\n\n    //color use indicator suggests that this should be updated on every timeframe\n    if (this.model.marker.color.use === \"indicator\") {\n      view.style(\"fill\", valuesPointer.color[key] ? valuesPointer.color[key] !== \"_default\" ? _this.cScale(valuesPointer.color[key]) : _this.model.marker.color.palette[\"_default\"] : COLOR_WHITEISH);\n    }\n\n    if (stack !== \"none\") view.transition().duration(Math.random() * 900 + 100).ease(d3.easeCircle).style(\"stroke-opacity\", 0.5);\n\n    if (this.model.time.record) this._export.write({\n      type: \"path\",\n      id: key,\n      time: this.model.time.value.getUTCFullYear(),\n      fill: this.cScale(valuesPointer.color[key]),\n      d: this.area(this.cached[key])\n    });\n  },\n  _setTooltip: function _setTooltip(tooltipText) {\n    if (tooltipText) {\n      var mouse = d3.mouse(this.graph.node()).map(function (d) {\n        return parseInt(d);\n      });\n\n      //position tooltip\n      this.tooltip.classed(\"vzb-hidden\", false).attr(\"transform\", \"translate(\" + mouse[0] + \",\" + mouse[1] + \")\").selectAll(\"text\").attr(\"text-anchor\", \"middle\").attr(\"alignment-baseline\", \"middle\").text(tooltipText);\n\n      var contentBBox = this.tooltip.select(\"text\").node().getBBox();\n\n      this.tooltip.select(\"rect\").attr(\"width\", contentBBox.width + 8).attr(\"height\", contentBBox.height + 8).attr(\"x\", -contentBBox.width - 25).attr(\"y\", -contentBBox.height - 25).attr(\"rx\", contentBBox.height * 0.2).attr(\"ry\", contentBBox.height * 0.2);\n\n      this.tooltip.selectAll(\"text\").attr(\"x\", -contentBBox.width - 25 + (contentBBox.width + 8) / 2).attr(\"y\", -contentBBox.height - 25 + (contentBBox.height + 11) / 2); // 11 is 8 for margin + 3 for strokes\n      var translateX = mouse[0] - contentBBox.width - 25 > 0 ? mouse[0] : contentBBox.width + 25;\n      var translateY = mouse[1] - contentBBox.height - 25 > 0 ? mouse[1] : contentBBox.height + 25;\n      this.tooltip.attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")\");\n    } else {\n\n      this.tooltip.classed(\"vzb-hidden\", true);\n    }\n  },\n  preload: function preload() {\n    var _join,\n        _this2 = this;\n\n    var _this = this;\n\n    var preload = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preload\"]);\n    var preloadKey = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preloadKey\"]);\n    if (!preload) return Promise.resolve();\n\n    var KEY = this.model.entities.dim;\n    var TIMEDIM = this.model.time.dim;\n\n    //build a query to the reader to fetch preload info\n    var query = {\n      language: this.model.locale.id,\n      from: \"datapoints\",\n      select: {\n        key: [KEY, TIMEDIM],\n        value: [preload]\n      },\n      where: { $and: [_defineProperty({}, KEY, \"$\" + KEY), _defineProperty({}, TIMEDIM, \"$\" + TIMEDIM)] },\n      join: (_join = {}, _defineProperty(_join, \"$\" + KEY, { key: KEY, where: _defineProperty({}, KEY, { $in: [preloadKey || \"world\"] }) }), _defineProperty(_join, \"$\" + TIMEDIM, { key: TIMEDIM, where: _defineProperty({}, TIMEDIM, this.model.time.formatDate(this.model.time.value)) }), _join),\n      order_by: [TIMEDIM]\n    };\n\n    return new Promise(function (resolve, reject) {\n\n      var dataPromise = _this2.model.data.load(query, _defineProperty({}, preload, function (d) {\n        return JSON.parse(d);\n      }));\n\n      dataPromise.then(function (dataId) {\n        _this.precomputedShape = _this.model.data.getData(dataId);\n        resolve();\n      }, function (err) {\n        return utils.warn(\"Problem with Preload mountainchart query: \", err, JSON.stringify(query));\n      });\n    });\n  }\n});\n\nexports.default = MountainChartComponent;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n * Axes dialog\n */\n\nvar Axes = Vizabi.Component.get(\"_dialog\").extend(\"axesmc\", {\n\n  /**\n   * Initializes the dialog component\n   * @param config component configuration\n   * @param context component context (parent)\n   */\n  init: function init(config, parent) {\n    this.name = \"axesmc\";\n    var _this = this;\n\n    this.model_binds = {\n      \"change:ui.chart.xLogStops\": function changeUiChartXLogStops() {\n        _this.updateView();\n      },\n      \"change:ui.chart.yMaxMethod\": function changeUiChartYMaxMethod() {\n        _this.updateView();\n      }\n    };\n\n    this.components = [{\n      component: Vizabi.Component.get(\"minmaxinputs\"),\n      placeholder: \".vzb-xlimits-container\",\n      model: [\"state.marker\", \"state.time\", \"locale\"],\n      markerID: \"axis_x\",\n      ui: {\n        selectDomainMinMax: false,\n        selectZoomedMinMax: true\n      }\n    }];\n\n    this._super(config, parent);\n    this.template = __webpack_require__(7);\n  },\n  readyOnce: function readyOnce() {\n    this._super();\n\n    var _this = this;\n\n    this.yMaxRadio = this.element.select(\".vzb-yaxis-container\").selectAll(\"input\").on(\"change\", function () {\n      _this.setModel(\"yMaxMethod\", d3.select(this).node().value);\n    });\n\n    this.xLogStops = this.element.select(\".vzb-xaxis-container\").selectAll(\"input\").on(\"change\", function () {\n      _this.setModel(\"xLogStops\", d3.select(this).node().value);\n    });\n\n    this.probeCheck = this.element.select(\".vzb-probe-check\").on(\"change\", function () {\n      _this.setModel(\"showProbeX\", d3.select(this).property(\"checked\"));\n    });\n\n    this.probeFieldEl = this.element.select(\".vzb-probe-field\").on(\"change\", function () {\n      var result = parseFloat(this.value.replace(\",\", \".\"));\n      if (!result || result <= _this.model.state.marker.axis_x.tailCutX) {\n        this.value = _this.model.ui.chart.probeX;\n        return;\n      } else if (result > _this.model.state.marker.axis_x.domainMax) {\n        result = _this.model.state.marker.axis_x.domainMax;\n      }\n      this.value = result;\n      _this.setModel(\"probeX\", result);\n    });\n\n    this.updateView();\n  },\n  updateView: function updateView() {\n    var _this = this;\n\n    this.yMaxRadio.property(\"checked\", function () {\n      return d3.select(this).node().value === _this.model.ui.chart.yMaxMethod;\n    });\n    this.xLogStops.property(\"checked\", function () {\n      return _this.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value) !== -1;\n    });\n    this.probeCheck.property(\"checked\", this.model.ui.chart.showProbeX);\n    this.probeFieldEl.property(\"value\", this.model.ui.chart.probeX);\n  },\n  setModel: function setModel(what, value) {\n    var result = void 0;\n\n    if (what == \"yMaxMethod\") {\n      result = value;\n    }\n    if (what == \"xLogStops\") {\n      result = [];\n      this.xLogStops.each(function () {\n        if (d3.select(this).property(\"checked\")) result.push(+d3.select(this).node().value);\n      });\n    }\n    if (what == \"probeX\" || what == \"showProbeX\") {\n      result = value;\n    }\n\n    this.model.ui.chart[what] = result;\n  }\n});\n\nexports.default = Axes;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils;\n\n\nvar MCMath = Vizabi.Class.extend({\n  init: function init(context) {\n    this.context = context;\n\n    this.xScaleFactor = 1;\n    this.xScaleShift = 0;\n  },\n  rescale: function rescale(x) {\n    return Math.exp(this.xScaleFactor * Math.log(x) + this.xScaleShift);\n  },\n  unscale: function unscale(x) {\n    return Math.exp((Math.log(x) - this.xScaleShift) / this.xScaleFactor);\n  },\n  generateMesh: function generateMesh(length, scaleType, domain) {\n    // span a uniform mesh across the entire X scale\n    // if the scale is log, the mesh would be exponentially distorted to look uniform\n\n    var rangeFrom = scaleType === \"linear\" ? domain[0] : Math.log(this.unscale(domain[0]));\n\n    var rangeTo = scaleType === \"linear\" ? domain[1] : Math.log(this.unscale(domain[1]));\n\n    var rangeStep = (rangeTo - rangeFrom) / length;\n\n    var mesh = d3.range(rangeFrom, rangeTo, rangeStep).concat(rangeTo);\n\n    if (scaleType !== \"linear\") {\n      mesh = mesh.map(function (dX) {\n        return Math.exp(dX);\n      });\n    } else {\n      mesh = mesh.filter(function (dX) {\n        return dX > 0;\n      });\n    }\n\n    return mesh;\n  },\n  gdpToMu: function gdpToMu(gdp, sigma, xScaleFactor, xScaleShift) {\n    // converting gdp per capita per day into MU for lognormal distribution\n    // see https://en.wikipedia.org/wiki/Log-normal_distribution\n    return Math.log(gdp / 365) - sigma * sigma / 2;\n  },\n  giniToSigma: function giniToSigma(gini) {\n    // The ginis are turned into std deviation.\n    // Mattias uses this formula in Excel: stddev = NORMSINV( ((gini/100)+1)/2 )*2^0.5\n    return this.normsinv((gini / 100 + 1) / 2) * Math.pow(2, 0.5);\n  },\n\n\n  // this function returns PDF values for a specified distribution\n  pdf: {\n    normal: function normal(x, mu, sigma) {\n      return Math.exp(-0.5 * Math.log(2 * Math.PI) - Math.log(sigma) - Math.pow(x - mu, 2) / (2 * sigma * sigma));\n    },\n    lognormal: function lognormal(x, mu, sigma) {\n      return Math.exp(-0.5 * Math.log(2 * Math.PI) //should not be different for the two scales- (scaleType==\"linear\"?Math.log(x):0)\n      - Math.log(sigma) - Math.pow(Math.log(x) - mu, 2) / (2 * sigma * sigma));\n    }\n  },\n\n  normsinv: function normsinv(p) {\n    //\n    // Lower tail quantile for standard normal distribution function.\n    //\n    // This function returns an approximation of the inverse cumulative\n    // standard normal distribution function.  I.e., given P, it returns\n    // an approximation to the X satisfying P = Pr{Z <= X} where Z is a\n    // random variable from the standard normal distribution.\n    //\n    // The algorithm uses a minimax approximation by rational functions\n    // and the result has a relative error whose absolute value is less\n    // than 1.15e-9.\n    //\n    // Author:      Peter John Acklam\n    // (Javascript version by Alankar Misra @ Digital Sutras (alankar@digitalsutras.com))\n    // Time-stamp:  2003-05-05 05:15:14\n    // E-mail:      pjacklam@online.no\n    // WWW URL:     http://home.online.no/~pjacklam\n\n    // Taken from http://home.online.no/~pjacklam/notes/invnorm/index.html\n    // adapted from Java code\n\n    // An algorithm with a relative error less than 1.15*10-9 in the entire region.\n\n    // Coefficients in rational approximations\n    var a = [-3.969683028665376e+01, 2.209460984245205e+02, -2.759285104469687e+02, 1.383577518672690e+02, -3.066479806614716e+01, 2.506628277459239e+00];\n    var b = [-5.447609879822406e+01, 1.615858368580409e+02, -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01];\n    var c = [-7.784894002430293e-03, -3.223964580411365e-01, -2.400758277161838e+00, -2.549732539343734e+00, 4.374664141464968e+00, 2.938163982698783e+00];\n    var d = [7.784695709041462e-03, 3.224671290700398e-01, 2.445134137142996e+00, 3.754408661907416e+00];\n\n    // Define break-points.\n    var plow = 0.02425;\n    var phigh = 1 - plow;\n\n    // Rational approximation for lower region:\n    if (p < plow) {\n      var _q = Math.sqrt(-2 * Math.log(p));\n      return (((((c[0] * _q + c[1]) * _q + c[2]) * _q + c[3]) * _q + c[4]) * _q + c[5]) / ((((d[0] * _q + d[1]) * _q + d[2]) * _q + d[3]) * _q + 1);\n    }\n\n    // Rational approximation for upper region:\n    if (phigh < p) {\n      var _q2 = Math.sqrt(-2 * Math.log(1 - p));\n      return -(((((c[0] * _q2 + c[1]) * _q2 + c[2]) * _q2 + c[3]) * _q2 + c[4]) * _q2 + c[5]) / ((((d[0] * _q2 + d[1]) * _q2 + d[2]) * _q2 + d[3]) * _q2 + 1);\n    }\n\n    // Rational approximation for central region:\n    var q = p - 0.5;\n    var r = q * q;\n    return (((((a[0] * r + a[1]) * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * q / (((((b[0] * r + b[1]) * r + b[2]) * r + b[3]) * r + b[4]) * r + 1);\n  }\n});\n\nexports.default = MCMath;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar MCProbe = Vizabi.Class.extend({\n  init: function init(context) {\n    this.context = context;\n  },\n  redraw: function redraw(options) {\n    var _this = this.context;\n    if (!options) options = {};\n\n    if (!options.level) options.level = _this.model.ui.chart.probeX;\n\n    _this.probeEl.classed(\"vzb-hidden\", !options.level || !_this.model.ui.chart.showProbeX);\n    if (!options.level) return;\n\n    _this.xAxisEl.call(_this.xAxis.highlightValue(options.full ? options.level : \"none\"));\n\n    var sumValue = 0;\n    var totalArea = 0;\n    var leftArea = 0;\n\n    var _computeAreas = function _computeAreas(d) {\n      sumValue += d.valuesPointer.axis_y[d.KEY()];\n      _this.cached[d.KEY()].forEach(function (d) {\n        totalArea += d.y;\n        if (_this._math.rescale(d.x) < options.level) leftArea += d.y;\n      });\n    };\n\n    if (_this.model.marker.stack.which === \"all\") {\n      _this.stackedPointers.forEach(_computeAreas);\n    } else if (_this.model.marker.stack.which === \"none\") {\n      _this.mountainPointers.forEach(_computeAreas);\n    } else {\n      _this.groupedPointers.forEach(_computeAreas);\n    }\n\n    var formatter1 = d3.format(\".3r\");\n    var formatter2 = _this.model.marker.axis_y.getTickFormatter();\n    _this.heightOfLabels = _this.heightOfLabels || 0.66 * _this.height;\n\n    _this.probeTextEl.each(function (d, i) {\n      if (i !== 8) return;\n      var view = d3.select(this);\n\n      if (!options.full && _this.model.ui.chart.probeX == _this.model.marker.axis_x.tailFatX) {\n\n        view.text(_this.translator(\"mount/extremepoverty\")).classed(\"vzb-hidden\", false).attr(\"x\", -_this.height).attr(\"y\", _this.xScale(options.level)).attr(\"dy\", \"-1.15em\").attr(\"dx\", \"0.5em\").attr(\"transform\", \"rotate(-90)\");\n\n        _this.heightOfLabels = _this.height - view.node().getBBox().width - view.node().getBBox().height * 1.75;\n      } else {\n        view.classed(\"vzb-hidden\", true);\n      }\n    });\n\n    _this.probeTextEl.each(function (d, i) {\n      if (i === 8) return;\n      var view = d3.select(this);\n\n      var string = void 0;\n      if (i === 0 || i === 4) string = formatter1(leftArea / totalArea * 100) + \"%\";\n      if (i === 1 || i === 5) string = formatter1(100 - leftArea / totalArea * 100) + \"%\";\n      if (i === 2 || i === 6) string = formatter2(sumValue * leftArea / totalArea);\n      if (i === 3 || i === 7) string = formatter2(sumValue * (1 - leftArea / totalArea)) + \" \" + _this.translator(\"mount/people\");\n\n      view.text(string).classed(\"vzb-hidden\", !options.full && (_this.someSelected || i !== 0 && i !== 4)).attr(\"x\", _this.xScale(options.level) + ([0, 4, 2, 6].indexOf(i) > -1 ? -6 : +5)).attr(\"y\", _this.heightOfLabels).attr(\"dy\", [0, 1, 4, 5].indexOf(i) > -1 ? 0 : \"1.5em\");\n    });\n\n    _this.probeLineEl.attr(\"x1\", _this.xScale(options.level)).attr(\"x2\", _this.xScale(options.level)).attr(\"y1\", _this.height + 6).attr(\"y2\", 0);\n  }\n});\n\nexports.default = MCProbe;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    iconClose = _Vizabi.iconset.close;\n\n\nvar MCSelectList = Vizabi.Class.extend({\n  init: function init(context) {\n    this.context = context;\n  },\n  rebuild: function rebuild(data) {\n    var _this = this.context;\n    var _local = this;\n\n    var listData = _this.mountainPointers.concat(_this.groupedPointers).concat(_this.stackedPointers).filter(function (f) {\n      return _this.model.marker.isSelected(f);\n    }).sort(function (a, b) {\n      if (a.sortValue && b.sortValue) {\n        if (a.sortValue[1] === b.sortValue[1]) {\n          return d3.descending(a.sortValue[0], b.sortValue[0]);\n        }\n        return d3.descending(a.sortValue[1], b.sortValue[1]);\n      }\n\n      if (a.aggrLevel != b.aggrLevel) {\n        return d3.descending(a.aggrLevel, b.aggrLevel);\n      } else if (a.aggrLevel && b.aggrLevel) {\n        return d3.descending(a.yMax, b.yMax);\n      }\n\n      return 0;\n    });\n    _this.selectList = _this.mountainLabelContainer.selectAll(\"g.vzb-mc-label\").data(utils.unique(listData, function (d) {\n      return d.KEY();\n    }));\n    _this.selectList.exit().remove();\n    _this.selectList = _this.selectList.enter().append(\"g\").attr(\"class\", \"vzb-mc-label\").each(function (d, i) {\n      var label = d3.select(this);\n      label.append(\"circle\").attr(\"class\", \"vzb-mc-label-legend\");\n      label.append(\"text\").attr(\"class\", \"vzb-mc-label-shadow vzb-mc-label-text\");\n      label.append(\"text\").attr(\"class\", \"vzb-mc-label-text\");\n      label.append(\"g\").attr(\"class\", \"vzb-mc-label-x vzb-label-shadow vzb-invisible\").on(\"click\", function (d, i) {\n        if (utils.isTouchDevice()) return;\n        d3.event.stopPropagation();\n        _this.model.marker.clearHighlighted();\n        _this.model.marker.selectMarker(d);\n        d3.event.stopPropagation();\n      }).onTap(function (d, i) {\n        d3.select(\"#\" + d.geo + \"-label-\" + _this._id).remove();\n        _this.model.marker.clearHighlighted();\n        _this.model.marker.selectMarker(d);\n      });\n      var labelCloseGroup = label.select(\"g.vzb-mc-label-x\");\n      if (!utils.isTouchDevice()) {\n        utils.setIcon(labelCloseGroup, iconClose).select(\"svg\").attr(\"class\", \"vzb-mc-label-x-icon\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n\n        labelCloseGroup.insert(\"circle\", \"svg\");\n      } else {\n        labelCloseGroup.append(\"rect\");\n        labelCloseGroup.append(\"text\").attr(\"class\", \"vzb-mc-label-x-text\").text(\"Deselect\");\n      }\n    }).on(\"mousemove\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _local.showCloseCross(d, true);\n      _this.model.marker.highlightMarker(d);\n    }).on(\"mouseout\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _local.showCloseCross(d, false);\n      _this.model.marker.clearHighlighted();\n    }).on(\"click\", function (d, i) {\n      if (utils.isTouchDevice()) return;\n      _this.model.marker.clearHighlighted();\n      _this.model.marker.selectMarker(d);\n    }).merge(_this.selectList);\n  },\n  redraw: function redraw() {\n    var _this = this.context;\n    if (!_this.selectList || !_this.someSelected) return;\n\n    var sample = _this.mountainLabelContainer.append(\"g\").attr(\"class\", \"vzb-mc-label\").append(\"text\").text(\"0\");\n    var fontHeight = sample.node().getBBox().height * 1.2;\n    var fontSizeToFontHeight = parseFloat(sample.style(\"font-size\")) / fontHeight;\n    d3.select(sample.node().parentNode).remove();\n    var formatter = _this.model.marker.axis_y.getTickFormatter();\n\n    var titleHeight = _this.yTitleEl.select(\"text\").node().getBBox().height || 0;\n\n    var maxFontHeight = (_this.height - titleHeight * 3) / (_this.selectList.data().length + 2);\n    if (fontHeight > maxFontHeight) fontHeight = maxFontHeight;\n\n    var currentAggrLevel = \"null\";\n    var aggrLevelSpacing = 0;\n\n    var groupLabels = _this.model.marker.color.getColorlegendMarker().label.getItems();\n\n    var isRTL = _this.model.locale.isRTL();\n\n    _this.selectList.attr(\"transform\", function (d, i) {\n      if (d.aggrLevel != currentAggrLevel) aggrLevelSpacing += fontHeight;\n      var spacing = fontHeight * i + titleHeight * 2 + aggrLevelSpacing;\n      currentAggrLevel = d.aggrLevel;\n      return \"translate(\" + (isRTL ? _this.width : 0) + \",\" + spacing + \")\";\n    }).each(function (d, i) {\n\n      var view = d3.select(this).attr(\"id\", d.geo + \"-label-\" + _this._id);\n      var name = \"\";\n      if (d.key) {\n        name = d.key === \"all\" ? _this.translator(\"mount/merging/world\") : groupLabels[d.key];\n      } else {\n        name = _this.values.label[d.KEY()];\n      }\n\n      var number = d.valuesPointer.axis_y[d.KEY()];\n\n      var string = name + \": \" + formatter(number) + (i === 0 ? \" \" + _this.translator(\"mount/people\") : \"\");\n\n      var text = view.selectAll(\".vzb-mc-label-text\").attr(\"x\", (isRTL ? -1 : 1) * fontHeight).attr(\"y\", fontHeight).text(string).style(\"font-size\", fontHeight === maxFontHeight ? fontHeight * fontSizeToFontHeight + \"px\" : null);\n\n      var contentBBox = text.node().getBBox();\n\n      var closeGroup = view.select(\".vzb-mc-label-x\");\n\n      if (utils.isTouchDevice()) {\n        var closeTextBBox = closeGroup.select(\"text\").node().getBBox();\n        closeGroup.classed(\"vzb-revert-color\", true).select(\".vzb-mc-label-x-text\").classed(\"vzb-revert-color\", true).attr(\"x\", contentBBox.width + contentBBox.height * 1.12 + closeTextBBox.width * 0.5).attr(\"y\", contentBBox.height * 0.55);\n\n        closeGroup.select(\"rect\").attr(\"width\", closeTextBBox.width + contentBBox.height * 0.6).attr(\"height\", contentBBox.height).attr(\"x\", contentBBox.width + contentBBox.height * 0.9).attr(\"y\", 0).attr(\"rx\", contentBBox.height * 0.25).attr(\"ry\", contentBBox.height * 0.25);\n      } else {\n        closeGroup.attr(\"x\", contentBBox.width + contentBBox.height * 1.1).attr(\"y\", contentBBox.height / 3);\n\n        closeGroup.select(\"circle\").attr(\"r\", contentBBox.height * 0.4).attr(\"cx\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * 1.1)).attr(\"cy\", contentBBox.height / 3);\n\n        closeGroup.select(\"svg\").attr(\"x\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * (1.1 - (isRTL ? -0.4 : 0.4)))).attr(\"y\", contentBBox.height * (1 / 3 - 0.4)).attr(\"width\", contentBBox.height * 0.8).attr(\"height\", contentBBox.height * 0.8);\n      }\n\n      view.select(\".vzb-mc-label-legend\").attr(\"r\", fontHeight / 3).attr(\"cx\", (isRTL ? -1 : 1) * fontHeight * 0.4).attr(\"cy\", fontHeight / 1.5).style(\"fill\", _this.cScale(d.valuesPointer.color[d.KEY()]));\n\n      view.onTap(function (d, i) {\n        d3.event.stopPropagation();\n        _this.model.marker.highlightMarker(d);\n        setTimeout(function () {\n          _this.model.marker.unhighlightMarker(d);\n        }, 2000);\n      });\n    });\n  },\n  showCloseCross: function showCloseCross(d, show) {\n    var _this = this.context;\n    var KEY = _this.KEY;\n    //show the little cross on the selected label\n    _this.selectList.filter(function (f) {\n      return f[KEY] == d[KEY];\n    }).select(\".vzb-mc-label-x\").classed(\"vzb-invisible\", !show);\n  }\n});\n\nexports.default = MCSelectList;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<div class='vzb-dialog-modal'>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-pin fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"pinDialog\\\"></span>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-drag fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"dragDialog\\\"></span>\\n    <div class=\\\"vzb-dialog-title\\\">\\n        <%=t (\\\"buttons/axes\\\") %>\\n    </div>\\n    <div class=\\\"vzb-dialog-content\\\">\\n        <div class=\\\"vzb-yaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\"><%=t (\\\"hints/mount/maxYvalue\\\") %></p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"immediate\\\"><%=t (\\\"mount/maxYmode/immediate\\\") %></label>\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"latest\\\"><%=t (\\\"mount/maxYmode/latest\\\") %></label>\\n            </form>\\n        </div>\\n        <div class=\\\"vzb-xaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n                <%=t (\\\"hints/mount/logXstops\\\") %>\\n            </p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"1\\\">1\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"2\\\">2\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"5\\\">5\\n            </form>\\n        </div>\\n        <p class=\\\"vzb-dialog-sublabel\\\">\\n            <%=t (\\\"hints/mount/xlimits\\\") %>\\n        </p>\\n        <div class=\\\"vzb-xlimits-container vzb-dialog-paragraph\\\"></div>\\n        <div class=\\\"vzb-probe-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n              <input type=\\\"checkbox\\\" name=\\\"probe\\\" class=\\\"vzb-probe-check\\\"> <%=t (\\\"hints/mount/probe\\\") %>\\n            </p>\\n            <input type=\\\"text\\\" class=\\\"vzb-probe-field\\\" name=\\\"probe\\\">\\n        </div>\\n    </div>\\n    <div class=\\\"vzb-dialog-buttons\\\">\\n        <div data-click=\\\"closeDialog\\\" class=\\\"vzb-dialog-button vzb-label-primary\\\">\\n            <%=t (\\\"buttons/ok\\\") %>\\n        </div>\\n    </div>\\n</div>\";\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- MountainChart Component -->\\n<div class=\\\"vzb-mountainchart\\\">\\n    <svg class=\\\"vzb-mountainchart-svg vzb-export\\\">\\n        <g class=\\\"vzb-mc-graph\\\">\\n            <rect class=\\\"vzb-mc-eventarea\\\"></rect>\\n            <g class=\\\"vzb-mc-year\\\"></g>\\n\\n            <g class=\\\"vzb-mc-mountains-mergestacked\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-mergegrouped\\\"></g>\\n            <g class=\\\"vzb-mc-mountains\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-mc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x\\\"></g>\\n\\n            <g class=\\\"vzb-mc-axis-labels\\\"></g>\\n            <g class=\\\"vzb-mc-probe\\\">\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-extremepoverty\\\"></text>\\n                <line></line>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-tooltip vzb-hidden\\\">\\n                <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n                <text class=\\\"vzb-tooltip-text\\\"></text>\\n            </g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// mountainchart.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 43bc40078ea947730f05","import \"./styles.scss\";\nimport component from \"./component\";\nimport \"./dialogs/axesmc/axesmc\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n// MOUNTAIN CHART TOOL\nconst MountainChart = Vizabi.Tool.extend(\"MountainChart\", {\n\n  /**\n   * Initializes the tool (MountainChart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"mountainchart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"locale\", \"data\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  default_model: {\n    state: {\n      time: {\n        \"delay\": 100,\n        \"delayThresholdX2\": 50,\n        \"delayThresholdX4\": 25\n      },\n      \"entities\": {\n        \"opacitySelectDim\": 0.3,\n        \"opacityRegular\": 0.7\n      }\n    },\n    locale: { },\n    ui: {\n      chart: {\n        manualSortingEnabled: true,\n        yMaxMethod: \"latest\",\n        showProbeX: true,\n        probeX: 1.85,\n        xLogStops: [1, 2, 5],\n        xPoints: 50,\n        preload: \"income_mountains\",\n        preloadKey: \"world\"\n      },\n      \"buttons\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"stack\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"stack\", \"axesmc\", \"colors\", \"presentation\", \"about\"]\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default MountainChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/**\n * VIZABI MOUNTAINCHART\n * This graph displays income distribution in the world\n *\n * Original code:\n * Angie https://github.com/angieskazka\n *\n * Contributions:\n * IncoCode https://github.com/IncoCode/\n * Arthur https://github.com/arthurcamara1\n *\n * Developed in Gapminder Foundation, 2015\n */\n\nconst { \n  utils, \n  _globals: globals,\n  iconset: {\n    warn: iconWarn,\n    question: iconQuestion\n  },\n  helpers: {\n    svgexport: Exporter,\n    \"d3.axisWithLabelPicker\": axisSmart,\n    \"d3.dynamicBackground\": DynamicBackground,\n  }\n} = Vizabi;\n\nimport MountainChartMath from \"./mountainchart-math\";\nimport Selectlist from \"./mountainchart-selectlist\";\nimport Probe from \"./mountainchart-probe\";\n\nconst THICKNESS_THRESHOLD = 0.001;\nconst COLOR_WHITEISH = \"#d3d3d3\";\n\n// MOUNTAIN CHART COMPONENT\nconst MountainChartComponent = Vizabi.Component.extend(\"mountainchart\", {\n\n  /**\n   * Initialize the component\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n\n    const _this = this;\n    this.name = \"mountainchart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [\n      { name: \"time\", type: \"time\" },\n      { name: \"entities\", type: \"entities\" },\n      { name: \"marker\", type: \"marker\" },\n      { name: \"locale\", type: \"locale\" },\n      { name: \"data\", type: \"data\" },\n      { name: \"ui\", type: \"ui\" }\n    ];\n\n    //attach event listeners to the model items\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:time.playing\": function(evt) {\n        // this listener is a patch for fixing #1228. time.js doesn't produce the last event\n        // with playing == false when paused softly\n        if (!_this.model.time.playing) {\n          _this.redrawDataPoints();\n        }\n      },\n      \"change:marker.axis_x.xScaleFactor\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.xScaleShift\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFatX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailCutX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFade\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.probeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.showProbeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xPoints\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateSize();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n      },\n      \"change:time.record\": function(evt) {\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:marker.highlight\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker.select\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this.redrawDataPoints();\n        _this._probe.redraw();\n      },\n      \"change:marker.opacitySelectDim\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          _this.zoomToMaxMin();\n          _this.redrawDataPoints();\n          _this._probe.redraw();\n        }\n      },\n      \"change:marker.group\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"group.merge\") > -1) return;\n        _this.ready();\n      },\n      \"change:marker.group.merge\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      },\n      \"change:marker.stack\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.ready();\n      },\n      \"change:marker.stack.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.stack.use\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPointsOnlyColors();\n        _this._selectlist.redraw();\n      },\n    };\n\n    this._super(config, context);\n\n    this._math = new MountainChartMath(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-mc-\")\n      .deleteClasses([\"vzb-mc-mountains-mergestacked\", \"vzb-mc-mountains-mergegrouped\", \"vzb-mc-mountains\", \"vzb-mc-year\", \"vzb-mc-mountains-labels\", \"vzb-mc-axis-labels\"]);\n    this._probe = new Probe(this);\n    this._selectlist = new Selectlist(this);\n\n    // define path generator\n    this.area = d3.area()\n      .curve(d3.curveBasis)\n      .x(d => _this.xScale(_this._math.rescale(d.x)))\n      .y0(d => _this.yScale(d.y0))\n      .y1(d => _this.yScale(d.y0 + d.y));\n\n    //define d3 stack layout\n    this.stack = d3.stack()\n      .order(d3.stackOrderReverse)\n      .value((d, key) => _this.cached[key][d].y);\n\n    // init internal variables\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n\n\n    this.rangeRatio = 1;\n    this.rangeShift = 0;\n    this.cached = {};\n    this.mesh = [];\n    this.yMax = 0;\n  },\n\n  domReady() {\n    const _this = this;\n\n    // reference elements\n    this.element = d3.select(this.element);\n    this.graph = this.element.select(\".vzb-mc-graph\");\n    this.xAxisEl = this.graph.select(\".vzb-mc-axis-x\");\n    this.xTitleEl = this.graph.select(\".vzb-mc-axis-x-title\");\n    this.yTitleEl = this.graph.select(\".vzb-mc-axis-y-title\");\n    this.infoEl = this.graph.select(\".vzb-mc-axis-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yearEl = this.graph.select(\".vzb-mc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.mountainMergeStackedContainer = this.graph.select(\".vzb-mc-mountains-mergestacked\");\n    this.mountainMergeGroupedContainer = this.graph.select(\".vzb-mc-mountains-mergegrouped\");\n    this.mountainAtomicContainer = this.graph.select(\".vzb-mc-mountains\");\n    this.mountainLabelContainer = this.graph.select(\".vzb-mc-mountains-labels\");\n    this.tooltip = this.element.select(\".vzb-mc-tooltip\");\n    this.eventAreaEl = this.element.select(\".vzb-mc-eventarea\");\n    this.probeEl = this.element.select(\".vzb-mc-probe\");\n    this.probeLineEl = this.probeEl.select(\"line\");\n    this.probeTextEl = this.probeEl.selectAll(\"text\");\n\n    this.element\n      .onTap((d, i) => {\n        _this._interact()._mouseout(d, i);\n      });\n  },\n\n  afterPreload() {\n    const _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    if (!this.precomputedShape || !this.precomputedShape[0] || !this.precomputedShape[0].income_mountains) return;\n\n    const yMax = this.precomputedShape[0].income_mountains[\"yMax_\" + this.model.ui.chart.yMaxMethod];\n    let shape = this.precomputedShape[0].income_mountains.shape;\n\n    if (!yMax || !shape || shape.length === 0) return;\n\n    this.xScale = d3.scaleLog().domain([this.model.marker.axis_x.domainMin, this.model.marker.axis_x.domainMax]);\n    this.yScale = d3.scaleLinear().domain([0, Math.round(yMax)]);\n\n    _this.updateSize(shape.length);\n    _this.zoomToMaxMin();\n\n    shape = shape.map((m, i) => ({ x: _this.mesh[i], y0: 0, y: +m }));\n\n    this.mountainAtomicContainer.selectAll(\".vzb-mc-prerender\")\n      .data([0])\n      .enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-prerender\")\n      .style(\"fill\", \"pink\")\n      .style(\"opacity\", 0)\n      .attr(\"d\", _this.area(shape))\n      .transition().duration(1000).ease(d3.easeLinear)\n      .style(\"opacity\", 1);\n  },\n\n  readyOnce() {\n\n    this.eventAreaEl\n      .on(\"mousemove\", function() {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw({\n          level: _this.xScale.invert(d3.mouse(this)[0]),\n          full: true\n        });\n      })\n      .on(\"mouseout\", () => {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw();\n      });\n\n    const _this = this;\n    this.on(\"resize\", () => {\n      //console.log(\"acting on resize\");\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updatePointers(); // respawn is needed\n      _this.redrawDataPoints();\n      _this._selectlist.redraw();\n      _this._probe.redraw();\n    });\n\n    this.KEY = this.model.entities.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n\n    this.mountainAtomicContainer.select(\".vzb-mc-prerender\").remove();\n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n  },\n\n  ready() {\n    //console.log(\"ready\")\n    const _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.model.marker.getFrame(this.model.time.value, values => {\n      if (!values) return;\n      _this.values = values;\n      _this.valuesAggregated = { color: {}, axis_y: {} };\n      \n      _this.model.marker.getFrame(_this.model.time.end, _this.updateEntities.bind(_this));\n      _this.updateSize();\n      _this.zoomToMaxMin();\n      _this._spawnMasks();\n      _this.updateTime();\n      _this.updatePointers();\n      _this._adjustMaxY({ force: true });\n      _this.redrawDataPoints();\n      _this.redrawDataPointsOnlyColors();\n      _this.highlightMarkers();\n      _this.selectMarkers();\n      _this._selectlist.redraw();\n      _this.updateOpacity();\n      _this.updateDoubtOpacity();\n      _this._probe.redraw();\n    });\n  },\n\n  frameChanged(frame, time) {\n    if (!frame) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.values = frame;\n    this.updateTime();\n    this.updatePointers();\n    this.redrawDataPoints();\n    this._selectlist.redraw();\n    this._probe.redraw();\n    this.updateDoubtOpacity();\n  },\n\n\n  updateSize(meshLength) {\n    const profiles = {\n      small: {\n        margin: { top: 10, right: 10, left: 10, bottom: 18 },\n        infoElHeight: 16\n      },\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 30 },\n        infoElHeight: 20\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 35 },\n        infoElHeight: 22\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 50 },\n        infoElHeight: 26\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 50 },\n        infoElHeight: 32\n      }\n    };\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const { margin } = this.activeProfile;\n    const { infoElHeight } = this.activeProfile;\n\n    //mesure width and height\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Mountain chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    const isRTL = this.model.locale.isRTL();\n\n    const yearLabelOptions = {\n      topOffset: this.getLayoutProfile() === \"large\" ? margin.top * 2 : 0,\n      xAlign: this.getLayoutProfile() === \"large\" ? (isRTL ? \"left\" : \"right\") : \"center\",\n      yAlign: this.getLayoutProfile() === \"large\" ? \"top\" : \"center\",\n      widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 8 / 10\n    };\n\n    //year is centered and resized\n    this.year\n      .setConditions(yearLabelOptions)\n      .resize(this.width, this.height);\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n\n    //need to know scale type of X to move on\n    const scaleType = this._readyOnce ? this.model.marker.axis_x.scaleType : \"log\";\n\n    //axis is updated\n    this.xAxis.scale(this.xScale)\n      .tickSizeOuter(0)\n      .tickPadding(9)\n      .tickSizeMinor(3, 0)\n      .labelerOptions({\n        scaleType,\n        toolMargin: margin,\n        pivotingLimit: margin.bottom * 1.5,\n        method: this.xAxis.METHOD_REPEATING,\n        stops: this._readyOnce ? this.model.ui.chart.xLogStops : [1],\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.xAxisEl\n      .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.xTitleEl.select(\"text\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\")\n      .attr(\"dy\", \"-0.36em\");\n\n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n\n    const warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height)\n      .attr(\"height\", warnBB.height)\n      .attr(\"x\", warnBB.height * 0.1)\n      .attr(\"y\", -warnBB.height * 1.0 + 1);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width - warnBB.width - warnBB.height * 2 : 0) + \",\" + (margin.top + warnBB.height * 1.5) + \")\")\n      .select(\"text\")\n      .attr(\"dx\", warnBB.height * 1.5);\n\n    if (this.infoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.infoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.infoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.eventAreaEl\n      .attr(\"y\", this.height)\n      .attr(\"width\", this.width)\n      .attr(\"height\", margin.bottom);\n\n    if (!meshLength) meshLength = this.model.ui.chart.xPoints;\n    this.mesh = this._math.generateMesh(meshLength, scaleType, this.xScale.domain());\n  },\n\n\n  zoomToMaxMin() {\n    const _this = this;\n    const mdl = this.model.marker.axis_x;\n\n    if (mdl.zoomedMin == null && mdl.domainMin == null || mdl.zoomedMax == null && mdl.domainMin == null) return;\n\n    const x1 = this.xScale(mdl.zoomedMin || mdl.domainMin);\n    const x2 = this.xScale(mdl.zoomedMax || mdl.domainMax);\n    // if we have same x1 and x2 then divider will be 0 and rangeRation will become -Infinity\n    if (!isFinite(x1) || !isFinite(x2) || x1 === x2) return;\n\n    this.rangeRatio = this.width / (x2 - x1) * this.rangeRatio;\n    this.rangeShift = (this.rangeShift - x1) / (x2 - x1) * this.width;\n\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n    this.xAxisEl.call(this.xAxis);\n  },\n\n\n  updateUIStrings() {\n    const _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    const xConceptprops = this.model.marker.axis_x.getConceptprops();\n\n\n    this.xTitleEl.select(\"text\")\n      .text(this.translator(\"unit/mountainchart_hardcoded_income_per_day\"));\n\n    this.yTitleEl.select(\"text\")\n      .text(this.translator(\"mount/title\"));\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.infoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.infoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.infoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.infoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this.updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this.updateDoubtOpacity();\n      });\n  },\n\n  updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  updateIndicators() {\n    const _this = this;\n\n    //fetch scales, or rebuild scales if there are none, then fetch\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.cScale = this.model.marker.color.getScale();\n\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  updateEntities(values = this.values) {\n    const _this = this;\n\n    // construct pointers\n    this.mountainPointers = this.model.marker.getKeys()\n      .filter(d => 1\n      && values.axis_x[d[_this.KEY]]\n      && values.axis_y[d[_this.KEY]]\n      && values.axis_s[d[_this.KEY]])\n      .map(d => {\n        const pointer = {};\n        pointer[_this.KEY] = d[_this.KEY];\n        pointer.KEY = function() {\n          return this[_this.KEY];\n        };\n        pointer.sortValue = [values.axis_y[pointer.KEY()] || 0, 0];\n        pointer.aggrLevel = 0;\n        return pointer;\n      });\n\n\n    //TODO: optimise this!\n    this.groupedPointers = d3.nest()\n      .key(d => _this.model.marker.stack.use === \"property\" ? values.stack[d.KEY()] : values.group[d.KEY()])\n      .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n      .entries(this.mountainPointers);\n\n\n    const groupManualSort = this.model.marker.group.manualSorting;\n    const isManualSortCorrect = utils.isArray(groupManualSort) && groupManualSort.length > 1;\n    this.groupedPointers.forEach(group => {\n      const groupSortValue = isManualSortCorrect ?\n        groupManualSort.includes(group.key) ?\n          groupManualSort.length - 1 - groupManualSort.indexOf(group.key) :\n          -1 :\n        d3.sum(group.values.map(m => m.sortValue[0]));\n\n      group.values.forEach(d => {\n        d.sortValue[1] = groupSortValue;\n      });\n\n      group[_this.model.entities.getDimension()] = group.key; // hack to get highlihgt and selection work\n      group.KEY = function() {\n        return this.key;\n      };\n      group.aggrLevel = 1;\n    });\n\n    const sortGroupKeys = {};\n    _this.groupedPointers.forEach(m => {\n      sortGroupKeys[m.key] = m.values[0].sortValue[1];\n    });\n\n\n    // update the stacked pointers\n    if (_this.model.marker.stack.which === \"none\") {\n      this.stackedPointers = [];\n      this.mountainPointers.sort((a, b) => b.sortValue[0] - a.sortValue[0]);\n\n    } else {\n      this.stackedPointers = d3.nest()\n        .key(d => values.stack[d.KEY()])\n        .key(d => values.group[d.KEY()])\n        .sortKeys((a, b) => sortGroupKeys[b] - sortGroupKeys[a])\n        .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n        .entries(this.mountainPointers);\n\n      this.mountainPointers.sort((a, b) => b.sortValue[1] - a.sortValue[1]);\n\n\n      this.stackedPointers.forEach(stack => {\n        stack.KEY = function() {\n          return this.key;\n        };\n        stack[_this.model.entities.getDimension()] = stack.key; // hack to get highlihgt and selection work\n        stack.aggrLevel = 2;\n      });\n    }\n\n    //bind the data to DOM elements\n    this.mountainsMergeStacked = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel2\")\n      .data(this.stackedPointers);\n    this.mountainsMergeGrouped = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel1\")\n      .data(this.groupedPointers);\n    this.mountainsAtomic = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel0\")\n      .data(this.mountainPointers);\n\n    //exit selection -- remove shapes\n    this.mountainsMergeStacked.exit().remove();\n    this.mountainsMergeGrouped.exit().remove();\n    this.mountainsAtomic.exit().remove();\n\n    //enter selection -- add shapes\n    this.mountainsMergeStacked = this.mountainsMergeStacked.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel2\")\n      .merge(this.mountainsMergeStacked);\n    this.mountainsMergeGrouped = this.mountainsMergeGrouped.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel1\")\n      .merge(this.mountainsMergeGrouped);\n    this.mountainsAtomic = this.mountainsAtomic.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel0\")\n      .merge(this.mountainsAtomic);\n\n    //add interaction\n    this.mountains = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain\");\n\n    this.mountains\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mousemove(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._click(d, i);\n        _this.highlightMarkers();\n      })\n      .onTap((d, i) => {\n        _this._interact()._click(d, i);\n        d3.event.stopPropagation();\n      })\n      .onLongTap((d, i) => {\n      });\n  },\n\n  _interact() {\n    const _this = this;\n\n    return {\n      _mousemove(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this.model.marker.highlightMarker(d);\n\n        const mouse = d3.mouse(_this.graph.node()).map(d => parseInt(d));\n\n        //position tooltip\n        _this._setTooltip(d.key ? _this.model.marker.color.getColorlegendMarker().label.getItems()[d.key] : _this.values.label[d.KEY()]);\n        _this._selectlist.showCloseCross(d, true);\n\n      },\n      _mouseout(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this._setTooltip(\"\");\n        _this.model.marker.clearHighlighted();\n        _this._selectlist.showCloseCross(d, false);\n\n      },\n      _click(d) {\n        const isPlayingOrDragging = _this.model.time.dragging || _this.model.time.playing;\n        if (!isPlayingOrDragging || _this.model.marker.isSelected(d)) {\n          _this.model.marker.selectMarker(d);\n        }\n      }\n    };\n\n  },\n\n  highlightMarkers() {\n    const _this = this;\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    if (!this.selectList || !this.someSelected) return;\n    this.selectList.classed(\"vzb-highlight\", d => _this.model.marker.isHighlighted(d));\n\n  },\n\n  selectMarkers() {\n    const _this = this;\n    this.someSelected = (this.model.marker.select.length > 0);\n\n    this._selectlist.rebuild();\n    this.nonSelectedOpacityZero = false;\n  },\n\n  _sumLeafPointersByMarker(branch, marker) {\n    const _this = this;\n    if (!branch.key) return _this.values[marker][branch.KEY()];\n    return d3.sum(branch.values.map(m => _this._sumLeafPointersByMarker(m, marker)));\n  },\n\n  updateOpacity() {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = 0.3;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.mountains.style(\"opacity\", d => {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n\n    });\n\n    this.mountains.classed(\"vzb-selected\", d => _this.model.marker.isSelected(d));\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.mountainsAtomic.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n  },\n\n  updatePointers() {\n    const _this = this;\n    this.yMax = 0;\n\n\n    //spawn the original mountains\n    this.mountainPointers.forEach((d, i) => {\n      const vertices = _this._spawn(_this.values, d);\n      _this.cached[d.KEY()] = vertices;\n      d.hidden = vertices.length === 0;\n    });\n\n\n    //recalculate stacking\n    if (_this.model.marker.stack.which !== \"none\") {\n      this.stackedPointers.forEach(group => {\n        let toStack = [];\n        group.values.forEach(subgroup => {\n          toStack = toStack.concat(subgroup.values.filter(f => !f.hidden));\n        });\n        _this.stack.keys(toStack.map(d => d.KEY()))(d3.range(_this.mesh.length))\n          .forEach((vertices, keyIndex) => {\n            const key = toStack[keyIndex].KEY();\n            vertices.forEach((d, verticesIndex) => {\n              _this.cached[key][verticesIndex].y0 = d[0];\n            });\n          });\n      });\n    }\n\n    this.mountainPointers.forEach(d => {\n      d.valuesPointer = _this.values;\n      d.yMax = d3.max(_this.cached[d.KEY()].map(m => m.y0 + m.y));\n      if (_this.yMax < d.yMax) _this.yMax = d.yMax;\n    });\n\n    const mergeGrouped = _this.model.marker.group.merge;\n    const mergeStacked = _this.model.marker.stack.merge;\n    //var dragOrPlay = (_this.model.time.dragging || _this.model.time.playing) && this.model.marker.stack.which !== \"none\";\n\n    //if(mergeStacked){\n    this.stackedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = \"_default\";\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //} else if (mergeGrouped || dragOrPlay){\n    this.groupedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = _this.values.color[firstLast.first.KEY()];\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //}\n\n    if (!mergeStacked && !mergeGrouped && this.model.marker.stack.use === \"property\") {\n      this.groupedPointers.forEach(d => {\n        const visible = d.values.filter(f => !f.hidden);\n        d.yMax = visible[0].yMax;\n        d.values.forEach(e => {\n          e.yMaxGroup = d.yMax;\n        });\n      });\n    }\n\n\n  },\n\n  _getFirstLastPointersInStack(group) {\n    let visible, visible2;\n    let first, last;\n\n    if (group.values[0].values) {\n      visible = group.values[0].values.filter(f => !f.hidden);\n      visible2 = group.values[group.values.length - 1].values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible2[visible2.length - 1];\n    } else {\n      visible = group.values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible[visible.length - 1];\n    }\n\n    if (!visible.length || (visible2 && !visible2.length)) utils.warn(\"mountain chart failed to generate shapes. check the incoming data\");\n\n    return {\n      first,\n      last\n    };\n  },\n\n  _getVerticesOfaMergedShape(arg) {\n    const _this = this;\n\n    const first = arg.first.KEY();\n    const last = arg.last.KEY();\n\n    return _this.mesh.map((m, i) => {\n      const y = _this.cached[first][i].y0 + _this.cached[first][i].y - _this.cached[last][i].y0;\n      const y0 = _this.cached[last][i].y0;\n      return {\n        x: m,\n        y0,\n        y\n      };\n    });\n  },\n\n  _spawnMasks() {\n    const _this = this;\n\n    const tailFatX = this._math.unscale(this.model.marker.axis_x.tailFatX);\n    const tailCutX = this._math.unscale(this.model.marker.axis_x.tailCutX);\n    const tailFade = this.model.marker.axis_x.tailFade;\n    const k = 2 * Math.PI / (Math.log(tailFatX) - Math.log(tailCutX));\n    const m = Math.PI - Math.log(tailFatX) * k;\n\n\n    this.spawnMask = [];\n    this.cosineShape = [];\n    this.cosineArea = 0;\n\n    this.mesh.forEach((dX, i) => {\n      _this.spawnMask[i] = dX < tailCutX ? 1 : (dX > tailFade * 7 ? 0 : Math.exp((tailCutX - dX) / tailFade));\n      _this.cosineShape[i] = (dX > tailCutX && dX < tailFatX ? (1 + Math.cos(Math.log(dX) * k + m)) : 0);\n      _this.cosineArea += _this.cosineShape[i];\n    });\n  },\n\n  _spawn(values, d) {\n    const _this = this;\n\n    const norm = values.axis_y[d.KEY()];\n    const sigma = _this._math.giniToSigma(values.axis_s[d.KEY()]);\n    const mu = _this._math.gdpToMu(values.axis_x[d.KEY()], sigma);\n\n    if (!norm || !mu || !sigma) return [];\n\n    const distribution = [];\n    let acc = 0;\n\n    this.mesh.forEach((dX, i) => {\n      distribution[i] = _this._math.pdf.lognormal(dX, mu, sigma);\n      acc += _this.spawnMask[i] * distribution[i];\n    });\n\n    const result = this.mesh.map((dX, i) => ({\n      x: dX,\n      y0: 0,\n      y: norm * (distribution[i] * (1 - _this.spawnMask[i]) + _this.cosineShape[i] / _this.cosineArea * acc)\n    }));\n\n    return result;\n  },\n\n  _adjustMaxY(options) {\n    if (!options) options = {};\n    const _this = this;\n    const method = this.model.ui.chart.yMaxMethod;\n\n    if (method !== \"immediate\" && !options.force) return;\n    if (method === \"latest\") {\n      const prevValues = _this.values;\n      _this.model.marker.getFrame(_this.model.time.end, values => {\n        if (!values) return;\n\n        //below is a complicated issue when updatePointers() is first calculated for one set of values (at the end of time series), then yMax is taken from that data (assuming that population always grows, so the last year has the highest mountain)\n        _this.values = values;\n        _this.updatePointers();\n\n        //after that updatePointers() is called with the actual data of the current time point\n        _this.values = prevValues;\n        _this.yScale.domain([0, Math.round(_this.yMax)]);\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      });\n    } else {\n      if (!_this.yMax) utils.warn(\"Setting yMax to \" + _this.yMax + \". You failed again :-/\");\n      _this.yScale.domain([0, Math.round(_this.yMax)]);\n    }\n  },\n\n  redrawDataPoints() {\n    const _this = this;\n    const mergeGrouped = this.model.marker.group.merge;\n    const mergeStacked = this.model.marker.stack.merge;\n    const stackMode = this.model.marker.stack.which;\n    //it's important to know if the chart is dragging or playing at the moment.\n    //because if that is the case, the mountain chart will merge the stacked entities to save performance\n    const dragOrPlay = (this.model.time.dragging || this.model.time.playing)\n      //never merge when no entities are stacked\n      && stackMode !== \"none\";\n\n    this._adjustMaxY();\n\n    this.mountainsMergeStacked.each(function(d) {\n      const view = d3.select(this);\n      const hidden = !mergeStacked;\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsMergeGrouped.each(function(d) {\n      const view = d3.select(this);\n      const hidden = (!mergeGrouped && !dragOrPlay) || (mergeStacked && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsAtomic.each(function(d, i) {\n      const view = d3.select(this);\n      const hidden = d.hidden || ((mergeGrouped || mergeStacked || dragOrPlay) && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    if (stackMode === \"none\") {\n      this.mountainsAtomic.sort((a, b) => b.yMax - a.yMax);\n\n    } else if (stackMode === \"all\") {\n      // do nothing if everything is stacked\n\n    } else {\n      if (mergeGrouped || dragOrPlay) {\n        // this.mountainsMergeGrouped.sort(function (a, b) {\n        //     return b.yMax - a.yMax;\n        // });\n      } else {\n        this.mountainsAtomic.sort((a, b) => b.yMaxGroup - a.yMaxGroup);\n      }\n    }\n\n\n    // exporting shapes for shape preloader. is needed once in a while\n    // if (!this.shapes) this.shapes = {}\n    // this.shapes[this.model.time.value.getUTCFullYear()] = {\n    //     yMax: d3.format(\".2e\")(_this.yMax),\n    //     shape: _this.cached[\"all\"].map(function (d) {return d3.format(\".2e\")(d.y);})\n    // }\n\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.mountains) return utils.warn(\"redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!\");\n    const isColorUseIndicator = this.model.marker.color.use === \"indicator\";\n    this.mountains.style(\"fill\", d => d.valuesPointer.color[d.KEY()] ?\n      (\n        isColorUseIndicator && d.valuesPointer.color[d.KEY()] == \"_default\" ?\n          _this.model.marker.color.palette[\"_default\"]\n          :\n          _this.cScale(d.valuesPointer.color[d.KEY()])\n      )\n      :\n      COLOR_WHITEISH);\n  },\n\n  _renderShape(view, key, hidden) {\n    const stack = this.model.marker.stack.which;\n    const _this = this;\n    const valuesPointer = view.datum().valuesPointer;\n\n    view.classed(\"vzb-hidden\", hidden);\n\n    if (hidden) {\n      if (stack !== \"none\") view.style(\"stroke-opacity\", 0);\n      return;\n    }\n\n    const filter = {};\n    filter[this.KEY] = key;\n    if (this.model.marker.isSelected(filter)) {\n      view.attr(\"d\", this.area(this.cached[key].filter(f => f.y > valuesPointer.axis_y[key] * THICKNESS_THRESHOLD)));\n    } else {\n      view.attr(\"d\", this.area(this.cached[key]));\n    }\n\n    //color use indicator suggests that this should be updated on every timeframe\n    if (this.model.marker.color.use === \"indicator\") {\n      view.style(\"fill\", valuesPointer.color[key] ?\n        (\n          valuesPointer.color[key] !== \"_default\" ?\n            _this.cScale(valuesPointer.color[key])\n            :\n            _this.model.marker.color.palette[\"_default\"]\n        )\n        :\n        COLOR_WHITEISH\n      );\n    }\n\n    if (stack !== \"none\") view\n      .transition().duration(Math.random() * 900 + 100).ease(d3.easeCircle)\n      .style(\"stroke-opacity\", 0.5);\n\n    if (this.model.time.record) this._export.write({\n      type: \"path\",\n      id: key,\n      time: this.model.time.value.getUTCFullYear(),\n      fill: this.cScale(valuesPointer.color[key]),\n      d: this.area(this.cached[key])\n    });\n  },\n\n  _setTooltip(tooltipText) {\n    if (tooltipText) {\n      const mouse = d3.mouse(this.graph.node()).map(d => parseInt(d));\n\n      //position tooltip\n      this.tooltip.classed(\"vzb-hidden\", false)\n        .attr(\"transform\", \"translate(\" + (mouse[0]) + \",\" + (mouse[1]) + \")\")\n        .selectAll(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"alignment-baseline\", \"middle\")\n        .text(tooltipText);\n\n      const contentBBox = this.tooltip.select(\"text\").node().getBBox();\n\n      this.tooltip.select(\"rect\")\n        .attr(\"width\", contentBBox.width + 8)\n        .attr(\"height\", contentBBox.height + 8)\n        .attr(\"x\", -contentBBox.width - 25)\n        .attr(\"y\", -contentBBox.height - 25)\n        .attr(\"rx\", contentBBox.height * 0.2)\n        .attr(\"ry\", contentBBox.height * 0.2);\n\n      this.tooltip.selectAll(\"text\")\n        .attr(\"x\", -contentBBox.width - 25 + ((contentBBox.width + 8) / 2))\n        .attr(\"y\", -contentBBox.height - 25 + ((contentBBox.height + 11) / 2)); // 11 is 8 for margin + 3 for strokes\n      const translateX = (mouse[0] - contentBBox.width - 25) > 0 ? mouse[0] : (contentBBox.width + 25);\n      const translateY = (mouse[1] - contentBBox.height - 25) > 0 ? mouse[1] : (contentBBox.height + 25);\n      this.tooltip\n        .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")\");\n\n    } else {\n\n      this.tooltip.classed(\"vzb-hidden\", true);\n    }\n  },\n\n  preload() {\n    const _this = this;\n    \n    const preload = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preload\"]);\n    const preloadKey = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preloadKey\"]);\n    if(!preload) return Promise.resolve();\n    \n    const KEY = this.model.entities.dim;\n    const TIMEDIM = this.model.time.dim;\n\n    //build a query to the reader to fetch preload info\n    const query = {\n      language: this.model.locale.id,\n      from: \"datapoints\",\n      select: {\n        key: [KEY, TIMEDIM],\n        value: [preload]\n      },\n      where: { $and: [\n        { [KEY]: \"$\" + KEY },\n        { [TIMEDIM]: \"$\" + TIMEDIM }\n      ] },\n      join: {\n        [\"$\" + KEY]: { key: KEY, where: { [KEY]: { $in: [preloadKey||\"world\"] } } },\n        [\"$\" + TIMEDIM]: { key: TIMEDIM, where: { [TIMEDIM]: this.model.time.formatDate(this.model.time.value) } }\n      },\n      order_by: [TIMEDIM]\n    };\n    \n    return new Promise((resolve, reject) => {\n\n      const dataPromise = this.model.data.load(query, {[preload]: d => JSON.parse(d)});\n\n      dataPromise.then(\n        function(dataId){\n          _this.precomputedShape = _this.model.data.getData(dataId);\n          resolve();\n        },\n        err => utils.warn(\"Problem with Preload mountainchart query: \", err, JSON.stringify(query))\n      );\n    });\n  }\n\n});\n\nexport default MountainChartComponent;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","/*\n * Axes dialog\n */\n\nconst Axes = Vizabi.Component.get(\"_dialog\").extend(\"axesmc\", {\n\n  /**\n   * Initializes the dialog component\n   * @param config component configuration\n   * @param context component context (parent)\n   */\n  init(config, parent) {\n    this.name = \"axesmc\";\n    const _this = this;\n\n    this.model_binds = {\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateView();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this.updateView();\n      }\n    };\n\n    this.components = [{\n      component: Vizabi.Component.get(\"minmaxinputs\"),\n      placeholder: \".vzb-xlimits-container\",\n      model: [\"state.marker\", \"state.time\", \"locale\"],\n      markerID: \"axis_x\",\n      ui: {\n        selectDomainMinMax: false,\n        selectZoomedMinMax: true\n      }\n    }];\n\n\n    this._super(config, parent);\n    this.template = require(\"./axesmc.html\");\n  },\n\n  readyOnce() {\n    this._super();\n\n    const _this = this;\n\n    this.yMaxRadio = this.element.select(\".vzb-yaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"yMaxMethod\", d3.select(this).node().value);\n      });\n\n    this.xLogStops = this.element.select(\".vzb-xaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"xLogStops\", d3.select(this).node().value);\n      });\n\n    this.probeCheck = this.element.select(\".vzb-probe-check\")\n      .on(\"change\", function() {\n        _this.setModel(\"showProbeX\", d3.select(this).property(\"checked\"));\n      });\n\n    this.probeFieldEl = this.element.select(\".vzb-probe-field\")\n      .on(\"change\", function() {\n        let result = parseFloat(this.value.replace(\",\", \".\"));\n        if (!result || result <= _this.model.state.marker.axis_x.tailCutX) {\n          this.value = _this.model.ui.chart.probeX;\n          return;\n        } else if (result > _this.model.state.marker.axis_x.domainMax) {\n          result = _this.model.state.marker.axis_x.domainMax;\n        }\n        this.value = result;\n        _this.setModel(\"probeX\", result);\n      });\n\n    this.updateView();\n\n  },\n\n  updateView() {\n    const _this = this;\n\n    this.yMaxRadio.property(\"checked\", function() {\n      return d3.select(this).node().value === _this.model.ui.chart.yMaxMethod;\n    });\n    this.xLogStops.property(\"checked\", function() {\n      return _this.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value) !== -1;\n    });\n    this.probeCheck.property(\"checked\", this.model.ui.chart.showProbeX);\n    this.probeFieldEl.property(\"value\", this.model.ui.chart.probeX);\n  },\n\n  setModel(what, value) {\n    let result;\n\n    if (what == \"yMaxMethod\") {\n      result = value;\n    }\n    if (what == \"xLogStops\") {\n      result = [];\n      this.xLogStops.each(function() {\n        if (d3.select(this).property(\"checked\")) result.push(+d3.select(this).node().value);\n      });\n    }\n    if (what == \"probeX\" || what == \"showProbeX\") {\n      result = value;\n    }\n\n    this.model.ui.chart[what] = result;\n  }\n});\n\nexport default Axes;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dialogs/axesmc/axesmc.js","const { utils } = Vizabi;\n\nconst MCMath = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.xScaleFactor = 1;\n    this.xScaleShift = 0;\n  },\n\n  rescale(x) {\n    return Math.exp(this.xScaleFactor * Math.log(x) + this.xScaleShift);\n  },\n  unscale(x) {\n    return Math.exp((Math.log(x) - this.xScaleShift) / this.xScaleFactor);\n  },\n\n  generateMesh(length, scaleType, domain) {\n    // span a uniform mesh across the entire X scale\n    // if the scale is log, the mesh would be exponentially distorted to look uniform\n\n    const rangeFrom = scaleType === \"linear\" ? domain[0]\n      : Math.log(this.unscale(domain[0]));\n\n    const rangeTo = scaleType === \"linear\" ? domain[1]\n      : Math.log(this.unscale(domain[1]));\n\n    const rangeStep = (rangeTo - rangeFrom) / length;\n\n    let mesh = d3.range(rangeFrom, rangeTo, rangeStep).concat(rangeTo);\n\n    if (scaleType !== \"linear\") {\n      mesh = mesh.map(dX => Math.exp(dX));\n    } else {\n      mesh = mesh.filter(dX => dX > 0);\n    }\n\n    return mesh;\n  },\n\n  gdpToMu(gdp, sigma, xScaleFactor, xScaleShift) {\n    // converting gdp per capita per day into MU for lognormal distribution\n    // see https://en.wikipedia.org/wiki/Log-normal_distribution\n    return Math.log(gdp / 365) - sigma * sigma / 2;\n  },\n\n  giniToSigma(gini) {\n    // The ginis are turned into std deviation.\n    // Mattias uses this formula in Excel: stddev = NORMSINV( ((gini/100)+1)/2 )*2^0.5\n    return this.normsinv(((gini / 100) + 1) / 2) * Math.pow(2, 0.5);\n  },\n\n  // this function returns PDF values for a specified distribution\n  pdf: {\n    normal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI)\n        - Math.log(sigma)\n        - Math.pow(x - mu, 2) / (2 * sigma * sigma)\n      );\n    },\n    lognormal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI) //should not be different for the two scales- (scaleType==\"linear\"?Math.log(x):0)\n        - Math.log(sigma)\n        - Math.pow(Math.log(x) - mu, 2) / (2 * sigma * sigma)\n      );\n    }\n  },\n\n\n  normsinv(p) {\n    //\n    // Lower tail quantile for standard normal distribution function.\n    //\n    // This function returns an approximation of the inverse cumulative\n    // standard normal distribution function.  I.e., given P, it returns\n    // an approximation to the X satisfying P = Pr{Z <= X} where Z is a\n    // random variable from the standard normal distribution.\n    //\n    // The algorithm uses a minimax approximation by rational functions\n    // and the result has a relative error whose absolute value is less\n    // than 1.15e-9.\n    //\n    // Author:      Peter John Acklam\n    // (Javascript version by Alankar Misra @ Digital Sutras (alankar@digitalsutras.com))\n    // Time-stamp:  2003-05-05 05:15:14\n    // E-mail:      pjacklam@online.no\n    // WWW URL:     http://home.online.no/~pjacklam\n\n    // Taken from http://home.online.no/~pjacklam/notes/invnorm/index.html\n    // adapted from Java code\n\n    // An algorithm with a relative error less than 1.15*10-9 in the entire region.\n\n    // Coefficients in rational approximations\n    const a = [-3.969683028665376e+01, 2.209460984245205e+02, -2.759285104469687e+02, 1.383577518672690e+02, -3.066479806614716e+01, 2.506628277459239e+00];\n    const b = [-5.447609879822406e+01, 1.615858368580409e+02, -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01];\n    const c = [-7.784894002430293e-03, -3.223964580411365e-01, -2.400758277161838e+00, -2.549732539343734e+00, 4.374664141464968e+00, 2.938163982698783e+00];\n    const d = [7.784695709041462e-03, 3.224671290700398e-01, 2.445134137142996e+00, 3.754408661907416e+00];\n\n    // Define break-points.\n    const plow = 0.02425;\n    const phigh = 1 - plow;\n\n    // Rational approximation for lower region:\n    if (p < plow) {\n      const q = Math.sqrt(-2 * Math.log(p));\n      return (((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for upper region:\n    if (phigh < p) {\n      const q = Math.sqrt(-2 * Math.log(1 - p));\n      return -(((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for central region:\n    const q = p - 0.5;\n    const r = q * q;\n    return (((((a[0] * r + a[1]) * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * q /\n      (((((b[0] * r + b[1]) * r + b[2]) * r + b[3]) * r + b[4]) * r + 1);\n\n  }\n\n\n});\n\nexport default MCMath;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-math.js","const MCProbe = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  redraw(options) {\n    const _this = this.context;\n    if (!options) options = {};\n\n    if (!options.level) options.level = _this.model.ui.chart.probeX;\n\n    _this.probeEl.classed(\"vzb-hidden\", !options.level || !_this.model.ui.chart.showProbeX);\n    if (!options.level) return;\n\n    _this.xAxisEl.call(_this.xAxis.highlightValue(options.full ? options.level : \"none\"));\n\n    let sumValue = 0;\n    let totalArea = 0;\n    let leftArea = 0;\n\n    const _computeAreas = function(d) {\n      sumValue += d.valuesPointer.axis_y[d.KEY()];\n      _this.cached[d.KEY()].forEach(d => {\n        totalArea += d.y;\n        if (_this._math.rescale(d.x) < options.level) leftArea += d.y;\n      });\n    };\n\n    if (_this.model.marker.stack.which === \"all\") {\n      _this.stackedPointers.forEach(_computeAreas);\n    } else if (_this.model.marker.stack.which === \"none\") {\n      _this.mountainPointers.forEach(_computeAreas);\n    } else {\n      _this.groupedPointers.forEach(_computeAreas);\n    }\n\n    const formatter1 = d3.format(\".3r\");\n    const formatter2 = _this.model.marker.axis_y.getTickFormatter();\n    _this.heightOfLabels = _this.heightOfLabels || (0.66 * _this.height);\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i !== 8) return;\n      const view = d3.select(this);\n\n      if (!options.full && _this.model.ui.chart.probeX == _this.model.marker.axis_x.tailFatX) {\n\n        view.text(_this.translator(\"mount/extremepoverty\"))\n          .classed(\"vzb-hidden\", false)\n          .attr(\"x\", -_this.height)\n          .attr(\"y\", _this.xScale(options.level))\n          .attr(\"dy\", \"-1.15em\")\n          .attr(\"dx\", \"0.5em\")\n          .attr(\"transform\", \"rotate(-90)\");\n\n        _this.heightOfLabels = _this.height - view.node().getBBox().width - view.node().getBBox().height * 1.75;\n      } else {\n        view.classed(\"vzb-hidden\", true);\n      }\n    });\n\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i === 8) return;\n      const view = d3.select(this);\n\n      let string;\n      if (i === 0 || i === 4) string = formatter1(leftArea / totalArea * 100) + \"%\";\n      if (i === 1 || i === 5) string = formatter1(100 - leftArea / totalArea * 100) + \"%\";\n      if (i === 2 || i === 6) string = formatter2(sumValue * leftArea / totalArea);\n      if (i === 3 || i === 7) string = formatter2(sumValue * (1 - leftArea / totalArea)) + \" \" + _this.translator(\"mount/people\");\n\n      view.text(string)\n        .classed(\"vzb-hidden\", !options.full && (_this.someSelected || (i !== 0 && i !== 4)))\n        .attr(\"x\", _this.xScale(options.level) + ([0, 4, 2, 6].indexOf(i) > -1 ? -6 : +5))\n        .attr(\"y\", _this.heightOfLabels)\n        .attr(\"dy\", [0, 1, 4, 5].indexOf(i) > -1 ? 0 : \"1.5em\");\n    });\n\n\n    _this.probeLineEl\n      .attr(\"x1\", _this.xScale(options.level))\n      .attr(\"x2\", _this.xScale(options.level))\n      .attr(\"y1\", _this.height + 6)\n      .attr(\"y2\", 0);\n\n\n  },\n\n\n});\n\nexport default MCProbe;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-probe.js","const { \n  utils,\n  iconset: {\n    close: iconClose\n  }\n} = Vizabi;\n\nconst MCSelectList = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  rebuild(data) {\n    const _this = this.context;\n    const _local = this;\n\n    const listData = _this.mountainPointers\n      .concat(_this.groupedPointers)\n      .concat(_this.stackedPointers)\n      .filter(f => _this.model.marker.isSelected(f)).sort((a, b) => {\n        if (a.sortValue && b.sortValue) {\n          if (a.sortValue[1] === b.sortValue[1]) {\n            return d3.descending(a.sortValue[0], b.sortValue[0]);\n          }\n          return d3.descending(a.sortValue[1], b.sortValue[1]);\n        }\n\n        if (a.aggrLevel != b.aggrLevel) {\n          return d3.descending(a.aggrLevel, b.aggrLevel);\n        } else if (a.aggrLevel && b.aggrLevel) {\n          return d3.descending(a.yMax, b.yMax);\n        }\n\n        return 0;\n      });\n    _this.selectList = _this.mountainLabelContainer.selectAll(\"g.vzb-mc-label\")\n      .data(utils.unique(listData, d => d.KEY()));\n    _this.selectList.exit().remove();\n    _this.selectList = _this.selectList.enter().append(\"g\")\n      .attr(\"class\", \"vzb-mc-label\")\n      .each(function(d, i) {\n        const label = d3.select(this);\n        label.append(\"circle\").attr(\"class\", \"vzb-mc-label-legend\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-shadow vzb-mc-label-text\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-text\");\n        label.append(\"g\").attr(\"class\", \"vzb-mc-label-x vzb-label-shadow vzb-invisible\")\n          .on(\"click\", (d, i) => {\n            if (utils.isTouchDevice()) return;\n            d3.event.stopPropagation();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d);\n            d3.event.stopPropagation();\n          })\n          .onTap((d, i) => {\n            d3.select(\"#\" + d.geo + \"-label-\" + _this._id).remove();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d);\n          });\n        const labelCloseGroup = label.select(\"g.vzb-mc-label-x\");\n        if (!utils.isTouchDevice()) {\n          utils.setIcon(labelCloseGroup, iconClose)\n            .select(\"svg\")\n            .attr(\"class\", \"vzb-mc-label-x-icon\")\n            .attr(\"width\", \"0px\")\n            .attr(\"height\", \"0px\");\n\n          labelCloseGroup.insert(\"circle\", \"svg\");\n\n        } else {\n          labelCloseGroup.append(\"rect\");\n          labelCloseGroup.append(\"text\")\n            .attr(\"class\", \"vzb-mc-label-x-text\")\n            .text(\"Deselect\");\n        }\n      })\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, true);\n        _this.model.marker.highlightMarker(d);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, false);\n        _this.model.marker.clearHighlighted();\n\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n        _this.model.marker.selectMarker(d);\n      })\n      .merge(_this.selectList);\n  },\n\n  redraw() {\n    const _this = this.context;\n    if (!_this.selectList || !_this.someSelected) return;\n\n    const sample = _this.mountainLabelContainer.append(\"g\").attr(\"class\", \"vzb-mc-label\").append(\"text\").text(\"0\");\n    let fontHeight = sample.node().getBBox().height * 1.2;\n    const fontSizeToFontHeight = parseFloat(sample.style(\"font-size\")) / fontHeight;\n    d3.select(sample.node().parentNode).remove();\n    const formatter = _this.model.marker.axis_y.getTickFormatter();\n\n    const titleHeight = _this.yTitleEl.select(\"text\").node().getBBox().height || 0;\n\n    const maxFontHeight = (_this.height - titleHeight * 3) / (_this.selectList.data().length + 2);\n    if (fontHeight > maxFontHeight) fontHeight = maxFontHeight;\n\n    let currentAggrLevel = \"null\";\n    let aggrLevelSpacing = 0;\n\n    const groupLabels = _this.model.marker.color.getColorlegendMarker().label.getItems();\n\n    const isRTL = _this.model.locale.isRTL();\n\n    _this.selectList\n      .attr(\"transform\", (d, i) => {\n        if (d.aggrLevel != currentAggrLevel) aggrLevelSpacing += fontHeight;\n        const spacing = fontHeight * i + titleHeight * 2 + aggrLevelSpacing;\n        currentAggrLevel = d.aggrLevel;\n        return \"translate(\" + (isRTL ? _this.width : 0) + \",\" + spacing + \")\";\n      })\n      .each(function(d, i) {\n\n        const view = d3.select(this).attr(\"id\", d.geo + \"-label-\" + _this._id);\n        let name = \"\";\n        if (d.key) {\n          name = d.key === \"all\" ? _this.translator(\"mount/merging/world\") : groupLabels[d.key];\n        } else {\n          name = _this.values.label[d.KEY()];\n        }\n\n        const number = d.valuesPointer.axis_y[d.KEY()];\n\n        const string = name + \": \" + formatter(number) + (i === 0 ? \" \" + _this.translator(\"mount/people\") : \"\");\n\n        const text = view.selectAll(\".vzb-mc-label-text\")\n          .attr(\"x\", (isRTL ? -1 : 1) * fontHeight)\n          .attr(\"y\", fontHeight)\n          .text(string)\n          .style(\"font-size\", fontHeight === maxFontHeight ? (fontHeight * fontSizeToFontHeight + \"px\") : null);\n\n        const contentBBox = text.node().getBBox();\n\n        const closeGroup = view.select(\".vzb-mc-label-x\");\n\n        if (utils.isTouchDevice()) {\n          const closeTextBBox = closeGroup.select(\"text\").node().getBBox();\n          closeGroup\n            .classed(\"vzb-revert-color\", true)\n            .select(\".vzb-mc-label-x-text\")\n            .classed(\"vzb-revert-color\", true)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.12 + closeTextBBox.width * 0.5)\n            .attr(\"y\", contentBBox.height * 0.55);\n\n          closeGroup.select(\"rect\")\n            .attr(\"width\", closeTextBBox.width + contentBBox.height * 0.6)\n            .attr(\"height\", contentBBox.height)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 0.9)\n            .attr(\"y\", 0)\n            .attr(\"rx\", contentBBox.height * 0.25)\n            .attr(\"ry\", contentBBox.height * 0.25);\n        } else {\n          closeGroup\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.1)\n            .attr(\"y\", contentBBox.height / 3);\n\n          closeGroup.select(\"circle\")\n            .attr(\"r\", contentBBox.height * 0.4)\n            .attr(\"cx\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * 1.1))\n            .attr(\"cy\", contentBBox.height / 3);\n\n          closeGroup.select(\"svg\")\n            .attr(\"x\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * (1.1 - (isRTL ? -0.4 : 0.4))))\n            .attr(\"y\", contentBBox.height * (1 / 3 - 0.4))\n            .attr(\"width\", contentBBox.height * 0.8)\n            .attr(\"height\", contentBBox.height * 0.8);\n        }\n\n        view.select(\".vzb-mc-label-legend\")\n          .attr(\"r\", fontHeight / 3)\n          .attr(\"cx\", (isRTL ? -1 : 1) * fontHeight * 0.4)\n          .attr(\"cy\", fontHeight / 1.5)\n          .style(\"fill\", _this.cScale(d.valuesPointer.color[d.KEY()]));\n\n        view.onTap((d, i) => {\n          d3.event.stopPropagation();\n          _this.model.marker.highlightMarker(d);\n          setTimeout(() => {\n            _this.model.marker.unhighlightMarker(d);\n          }, 2000);\n        });\n      });\n  },\n\n  showCloseCross(d, show) {\n    const _this = this.context;\n    const KEY = _this.KEY;\n    //show the little cross on the selected label\n    _this.selectList\n      .filter(f => f[KEY] == d[KEY])\n      .select(\".vzb-mc-label-x\")\n      .classed(\"vzb-invisible\", !show);\n  },\n\n});\n\nexport default MCSelectList;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-selectlist.js","module.exports = \"<div class='vzb-dialog-modal'>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-pin fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"pinDialog\\\"></span>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-drag fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"dragDialog\\\"></span>\\n    <div class=\\\"vzb-dialog-title\\\">\\n        <%=t (\\\"buttons/axes\\\") %>\\n    </div>\\n    <div class=\\\"vzb-dialog-content\\\">\\n        <div class=\\\"vzb-yaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\"><%=t (\\\"hints/mount/maxYvalue\\\") %></p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"immediate\\\"><%=t (\\\"mount/maxYmode/immediate\\\") %></label>\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"latest\\\"><%=t (\\\"mount/maxYmode/latest\\\") %></label>\\n            </form>\\n        </div>\\n        <div class=\\\"vzb-xaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n                <%=t (\\\"hints/mount/logXstops\\\") %>\\n            </p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"1\\\">1\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"2\\\">2\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"5\\\">5\\n            </form>\\n        </div>\\n        <p class=\\\"vzb-dialog-sublabel\\\">\\n            <%=t (\\\"hints/mount/xlimits\\\") %>\\n        </p>\\n        <div class=\\\"vzb-xlimits-container vzb-dialog-paragraph\\\"></div>\\n        <div class=\\\"vzb-probe-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n              <input type=\\\"checkbox\\\" name=\\\"probe\\\" class=\\\"vzb-probe-check\\\"> <%=t (\\\"hints/mount/probe\\\") %>\\n            </p>\\n            <input type=\\\"text\\\" class=\\\"vzb-probe-field\\\" name=\\\"probe\\\">\\n        </div>\\n    </div>\\n    <div class=\\\"vzb-dialog-buttons\\\">\\n        <div data-click=\\\"closeDialog\\\" class=\\\"vzb-dialog-button vzb-label-primary\\\">\\n            <%=t (\\\"buttons/ok\\\") %>\\n        </div>\\n    </div>\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/dialogs/axesmc/axesmc.html\n// module id = 7\n// module chunks = 0","module.exports = \"<!-- MountainChart Component -->\\n<div class=\\\"vzb-mountainchart\\\">\\n    <svg class=\\\"vzb-mountainchart-svg vzb-export\\\">\\n        <g class=\\\"vzb-mc-graph\\\">\\n            <rect class=\\\"vzb-mc-eventarea\\\"></rect>\\n            <g class=\\\"vzb-mc-year\\\"></g>\\n\\n            <g class=\\\"vzb-mc-mountains-mergestacked\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-mergegrouped\\\"></g>\\n            <g class=\\\"vzb-mc-mountains\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-mc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x\\\"></g>\\n\\n            <g class=\\\"vzb-mc-axis-labels\\\"></g>\\n            <g class=\\\"vzb-mc-probe\\\">\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-extremepoverty\\\"></text>\\n                <line></line>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-tooltip vzb-hidden\\\">\\n                <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n                <text class=\\\"vzb-tooltip-text\\\"></text>\\n            </g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}